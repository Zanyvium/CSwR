<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.3 Network failure | Computational Statistics with R</title>
  <meta name="description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="5.3 Network failure | Computational Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.3 Network failure | Computational Statistics with R" />
  
  <meta name="twitter:description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  

<meta name="author" content="Niels Richard Hansen" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="5-2-importance-sampling.html"/>
<link rel="next" href="6-four-examples.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-intro.html"><a href="1-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html"><i class="fa fa-check"></i><b>1.1</b> Smoothing</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#intro-angles"><i class="fa fa-check"></i><b>1.1.1</b> Angle distributions in proteins</a></li>
<li class="chapter" data-level="1.1.2" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#using-ggplot2"><i class="fa fa-check"></i><b>1.1.2</b> Using ggplot2</a></li>
<li class="chapter" data-level="1.1.3" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#changing-the-defaults"><i class="fa fa-check"></i><b>1.1.3</b> Changing the defaults</a></li>
<li class="chapter" data-level="1.1.4" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#multivariate-smoothing"><i class="fa fa-check"></i><b>1.1.4</b> Multivariate methods</a></li>
<li class="chapter" data-level="1.1.5" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#large-scale-smoothing"><i class="fa fa-check"></i><b>1.1.5</b> Large scale smoothing</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html"><i class="fa fa-check"></i><b>1.2</b> Monte Carlo methods</a><ul>
<li class="chapter" data-level="1.2.1" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html#vM"><i class="fa fa-check"></i><b>1.2.1</b> Univariate von Mises distributions</a></li>
<li class="chapter" data-level="1.2.2" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html#mixtures-of-von-mises-distributions"><i class="fa fa-check"></i><b>1.2.2</b> Mixtures of von Mises distributions</a></li>
<li class="chapter" data-level="1.2.3" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html#large-scale-monte-carlo-methods"><i class="fa fa-check"></i><b>1.2.3</b> Large scale Monte Carlo methods</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="1-3-optimization.html"><a href="1-3-optimization.html"><i class="fa fa-check"></i><b>1.3</b> Optimization</a><ul>
<li class="chapter" data-level="1.3.1" data-path="1-3-optimization.html"><a href="1-3-optimization.html#the-em-algorithm"><i class="fa fa-check"></i><b>1.3.1</b> The EM-algorithm</a></li>
<li class="chapter" data-level="1.3.2" data-path="1-3-optimization.html"><a href="1-3-optimization.html#large-scale-optimization"><i class="fa fa-check"></i><b>1.3.2</b> Large scale optimization</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part I: Smoothing</b></span></li>
<li class="chapter" data-level="2" data-path="2-density.html"><a href="2-density.html"><i class="fa fa-check"></i><b>2</b> Density estimation</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-unidens.html"><a href="2-1-unidens.html"><i class="fa fa-check"></i><b>2.1</b> Univariate density estimation</a></li>
<li class="chapter" data-level="2.2" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html"><i class="fa fa-check"></i><b>2.2</b> Kernel methods</a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html#implementation"><i class="fa fa-check"></i><b>2.2.1</b> Implementation</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html#benchmarking"><i class="fa fa-check"></i><b>2.2.2</b> Benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html"><i class="fa fa-check"></i><b>2.3</b> Bandwidth selection</a><ul>
<li class="chapter" data-level="2.3.1" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#rectangular"><i class="fa fa-check"></i><b>2.3.1</b> Revisiting the rectangular kernel</a></li>
<li class="chapter" data-level="2.3.2" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#ise-mise-and-mse-for-kernel-estimators"><i class="fa fa-check"></i><b>2.3.2</b> ISE, MISE and MSE for kernel estimators</a></li>
<li class="chapter" data-level="2.3.3" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#plug-in-estimation-of-the-oracle-bandwidth"><i class="fa fa-check"></i><b>2.3.3</b> Plug-in estimation of the oracle bandwidth</a></li>
<li class="chapter" data-level="2.3.4" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#cv"><i class="fa fa-check"></i><b>2.3.4</b> Cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="2-4-likelihood.html"><a href="2-4-likelihood.html"><i class="fa fa-check"></i><b>2.4</b> Likelihood considerations</a><ul>
<li class="chapter" data-level="2.4.1" data-path="2-4-likelihood.html"><a href="2-4-likelihood.html#sieves"><i class="fa fa-check"></i><b>2.4.1</b> Method of sieves</a></li>
<li class="chapter" data-level="2.4.2" data-path="2-4-likelihood.html"><a href="2-4-likelihood.html#basis-density"><i class="fa fa-check"></i><b>2.4.2</b> Basis expansions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="2-5-density-ex.html"><a href="2-5-density-ex.html"><i class="fa fa-check"></i><b>2.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="2-5-density-ex.html"><a href="2-5-density-ex.html#kernel-density-estimation"><i class="fa fa-check"></i>Kernel density estimation</a></li>
<li class="chapter" data-level="" data-path="2-5-density-ex.html"><a href="2-5-density-ex.html#benchmarking-1"><i class="fa fa-check"></i>Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-bivariate.html"><a href="3-bivariate.html"><i class="fa fa-check"></i><b>3</b> Bivariate smoothing</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html"><i class="fa fa-check"></i><b>3.1</b> Nearest neighbor smoothers</a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html#linear-smoothers"><i class="fa fa-check"></i><b>3.1.1</b> Linear smoothers</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html#implementing-the-running-mean"><i class="fa fa-check"></i><b>3.1.2</b> Implementing the running mean</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html#choose-k-by-cross-validation"><i class="fa fa-check"></i><b>3.1.3</b> Choose <span class="math inline">\(k\)</span> by cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-2-kernel-methods.html"><a href="3-2-kernel-methods.html"><i class="fa fa-check"></i><b>3.2</b> Kernel methods</a><ul>
<li class="chapter" data-level="3.2.1" data-path="3-2-kernel-methods.html"><a href="3-2-kernel-methods.html#nadarayawatson-kernel-smoothing"><i class="fa fa-check"></i><b>3.2.1</b> Nadaraya–Watson kernel smoothing</a></li>
<li class="chapter" data-level="3.2.2" data-path="3-2-kernel-methods.html"><a href="3-2-kernel-methods.html#local-regression-smoothers"><i class="fa fa-check"></i><b>3.2.2</b> Local regression smoothers</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-3-sparse-linear-algebra.html"><a href="3-3-sparse-linear-algebra.html"><i class="fa fa-check"></i><b>3.3</b> Sparse linear algebra</a></li>
<li class="chapter" data-level="3.4" data-path="3-4-onb.html"><a href="3-4-onb.html"><i class="fa fa-check"></i><b>3.4</b> Orthogonal basis expansions</a><ul>
<li class="chapter" data-level="3.4.1" data-path="3-4-onb.html"><a href="3-4-onb.html#polynomial-expansions"><i class="fa fa-check"></i><b>3.4.1</b> Polynomial expansions</a></li>
<li class="chapter" data-level="3.4.2" data-path="3-4-onb.html"><a href="3-4-onb.html#fourier-expansions"><i class="fa fa-check"></i><b>3.4.2</b> Fourier expansions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="3-5-splines.html"><a href="3-5-splines.html"><i class="fa fa-check"></i><b>3.5</b> Splines</a><ul>
<li class="chapter" data-level="3.5.1" data-path="3-5-splines.html"><a href="3-5-splines.html#smoothing-splines"><i class="fa fa-check"></i><b>3.5.1</b> Smoothing splines</a></li>
<li class="chapter" data-level="3.5.2" data-path="3-5-splines.html"><a href="3-5-splines.html#splines-in-r"><i class="fa fa-check"></i><b>3.5.2</b> Splines in R</a></li>
<li class="chapter" data-level="3.5.3" data-path="3-5-splines.html"><a href="3-5-splines.html#efficient-splines"><i class="fa fa-check"></i><b>3.5.3</b> Efficient computation with splines</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="3-6-gaussian-processes.html"><a href="3-6-gaussian-processes.html"><i class="fa fa-check"></i><b>3.6</b> Gaussian processes</a></li>
<li class="chapter" data-level="3.7" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html"><i class="fa fa-check"></i><b>3.7</b> The Kalman filter</a><ul>
<li class="chapter" data-level="3.7.1" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html#ar1-example"><i class="fa fa-check"></i><b>3.7.1</b> AR(1)-example</a></li>
<li class="chapter" data-level="3.7.2" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html#the-kalman-smoother"><i class="fa fa-check"></i><b>3.7.2</b> The Kalman smoother</a></li>
<li class="chapter" data-level="3.7.3" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html#implementation"><i class="fa fa-check"></i><b>3.7.3</b> Implementation</a></li>
<li class="chapter" data-level="3.7.4" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html#the-kalman-filter-1"><i class="fa fa-check"></i><b>3.7.4</b> The Kalman filter</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="3-8-bivariate-ex.html"><a href="3-8-bivariate-ex.html"><i class="fa fa-check"></i><b>3.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="3-8-bivariate-ex.html"><a href="3-8-bivariate-ex.html#nearest-neighbors"><i class="fa fa-check"></i>Nearest neighbors</a></li>
<li class="chapter" data-level="" data-path="3-8-bivariate-ex.html"><a href="3-8-bivariate-ex.html#kernel-estimators"><i class="fa fa-check"></i>Kernel estimators</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part II: Monte Carlo Methods</b></span></li>
<li class="chapter" data-level="4" data-path="4-univariate-random-variables.html"><a href="4-univariate-random-variables.html"><i class="fa fa-check"></i><b>4</b> Univariate random variables</a><ul>
<li class="chapter" data-level="4.1" data-path="4-1-pseudorandom-number-generators.html"><a href="4-1-pseudorandom-number-generators.html"><i class="fa fa-check"></i><b>4.1</b> Pseudorandom number generators</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-1-pseudorandom-number-generators.html"><a href="4-1-pseudorandom-number-generators.html#implementing-a-pseudorandom-number-generator"><i class="fa fa-check"></i><b>4.1.1</b> Implementing a pseudorandom number generator</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-1-pseudorandom-number-generators.html"><a href="4-1-pseudorandom-number-generators.html#pseudorandom-number-packages"><i class="fa fa-check"></i><b>4.1.2</b> Pseudorandom number packages</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-2-transformation-techniques.html"><a href="4-2-transformation-techniques.html"><i class="fa fa-check"></i><b>4.2</b> Transformation techniques</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-2-transformation-techniques.html"><a href="4-2-transformation-techniques.html#sampling-from-a-t-distribution"><i class="fa fa-check"></i><b>4.2.1</b> Sampling from a <span class="math inline">\(t\)</span>-distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-3-reject-samp.html"><a href="4-3-reject-samp.html"><i class="fa fa-check"></i><b>4.3</b> Rejection sampling</a><ul>
<li class="chapter" data-level="4.3.1" data-path="4-3-reject-samp.html"><a href="4-3-reject-samp.html#vMsim"><i class="fa fa-check"></i><b>4.3.1</b> von Mises distribution</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-3-reject-samp.html"><a href="4-3-reject-samp.html#gamma-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Gamma distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-4-adaptive.html"><a href="4-4-adaptive.html"><i class="fa fa-check"></i><b>4.4</b> Adaptive envelopes</a><ul>
<li class="chapter" data-level="4.4.1" data-path="4-4-adaptive.html"><a href="4-4-adaptive.html#beta-distribution"><i class="fa fa-check"></i><b>4.4.1</b> Beta distribution</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-4-adaptive.html"><a href="4-4-adaptive.html#von-mises-distribution"><i class="fa fa-check"></i><b>4.4.2</b> von Mises distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="4-5-univariate-ex.html"><a href="4-5-univariate-ex.html"><i class="fa fa-check"></i><b>4.5</b> Exercises</a><ul>
<li class="chapter" data-level="4.5.1" data-path="4-5-univariate-ex.html"><a href="4-5-univariate-ex.html#rejection-sampling-of-gaussian-random-variables"><i class="fa fa-check"></i><b>4.5.1</b> Rejection sampling of Gaussian random variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-mci.html"><a href="5-mci.html"><i class="fa fa-check"></i><b>5</b> Monte Carlo integration</a><ul>
<li class="chapter" data-level="5.1" data-path="5-1-assessment.html"><a href="5-1-assessment.html"><i class="fa fa-check"></i><b>5.1</b> Assessment</a><ul>
<li class="chapter" data-level="5.1.1" data-path="5-1-assessment.html"><a href="5-1-assessment.html#CLT-gamma"><i class="fa fa-check"></i><b>5.1.1</b> Using the central limit theorem</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-1-assessment.html"><a href="5-1-assessment.html#concentration-inequalities"><i class="fa fa-check"></i><b>5.1.2</b> Concentration inequalities</a></li>
<li class="chapter" data-level="5.1.3" data-path="5-1-assessment.html"><a href="5-1-assessment.html#exponential-tail-bound-for-gamma-distributed-variables"><i class="fa fa-check"></i><b>5.1.3</b> Exponential tail bound for Gamma distributed variables</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-2-importance-sampling.html"><a href="5-2-importance-sampling.html"><i class="fa fa-check"></i><b>5.2</b> Importance sampling</a><ul>
<li class="chapter" data-level="5.2.1" data-path="5-2-importance-sampling.html"><a href="5-2-importance-sampling.html#unknown-normalization-constants"><i class="fa fa-check"></i><b>5.2.1</b> Unknown normalization constants</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-2-importance-sampling.html"><a href="5-2-importance-sampling.html#hd-int"><i class="fa fa-check"></i><b>5.2.2</b> Computing a high-dimensional integral</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-3-network.html"><a href="5-3-network.html"><i class="fa fa-check"></i><b>5.3</b> Network failure</a><ul>
<li class="chapter" data-level="5.3.1" data-path="5-3-network.html"><a href="5-3-network.html#object-oriented-implementations"><i class="fa fa-check"></i><b>5.3.1</b> Object oriented implementations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part III: Optimization</b></span></li>
<li class="chapter" data-level="6" data-path="6-four-examples.html"><a href="6-four-examples.html"><i class="fa fa-check"></i><b>6</b> Four Examples</a><ul>
<li class="chapter" data-level="6.1" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html"><i class="fa fa-check"></i><b>6.1</b> Exponential families</a><ul>
<li class="chapter" data-level="6.1.1" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#full-exponential-families"><i class="fa fa-check"></i><b>6.1.1</b> Full exponential families</a></li>
<li class="chapter" data-level="6.1.2" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#bayes-net"><i class="fa fa-check"></i><b>6.1.2</b> Exponential family Bayesian networks</a></li>
<li class="chapter" data-level="6.1.3" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#exp-fam-deriv"><i class="fa fa-check"></i><b>6.1.3</b> Likelihood computations</a></li>
<li class="chapter" data-level="6.1.4" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#curved-exponential-families"><i class="fa fa-check"></i><b>6.1.4</b> Curved exponential families</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-2-multinomial-models.html"><a href="6-2-multinomial-models.html"><i class="fa fa-check"></i><b>6.2</b> Multinomial models</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-2-multinomial-models.html"><a href="6-2-multinomial-models.html#pep-moth"><i class="fa fa-check"></i><b>6.2.1</b> Peppered Moths</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-3-regression.html"><a href="6-3-regression.html"><i class="fa fa-check"></i><b>6.3</b> Regression models</a></li>
<li class="chapter" data-level="6.4" data-path="6-4-finite-mixture-models.html"><a href="6-4-finite-mixture-models.html"><i class="fa fa-check"></i><b>6.4</b> Finite mixture models</a><ul>
<li class="chapter" data-level="6.4.1" data-path="6-4-finite-mixture-models.html"><a href="6-4-finite-mixture-models.html#Gaus-mix-ex"><i class="fa fa-check"></i><b>6.4.1</b> Gaussian mixtures</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="6-5-mixed-models.html"><a href="6-5-mixed-models.html"><i class="fa fa-check"></i><b>6.5</b> Mixed models</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-numopt.html"><a href="7-numopt.html"><i class="fa fa-check"></i><b>7</b> Numerical optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html"><i class="fa fa-check"></i><b>7.1</b> Algorithms and convergence</a><ul>
<li class="chapter" data-level="7.1.1" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#descent-algorithms"><i class="fa fa-check"></i><b>7.1.1</b> Descent algorithms</a></li>
<li class="chapter" data-level="7.1.2" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#maps-and-fixed-points"><i class="fa fa-check"></i><b>7.1.2</b> Maps and fixed points</a></li>
<li class="chapter" data-level="7.1.3" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#convergence-rate"><i class="fa fa-check"></i><b>7.1.3</b> Convergence rate</a></li>
<li class="chapter" data-level="7.1.4" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#stopping-criteria"><i class="fa fa-check"></i><b>7.1.4</b> Stopping criteria</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html"><i class="fa fa-check"></i><b>7.2</b> Descent direction algorithms</a><ul>
<li class="chapter" data-level="7.2.1" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#line-search"><i class="fa fa-check"></i><b>7.2.1</b> Line search</a></li>
<li class="chapter" data-level="7.2.2" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#gradient-descent"><i class="fa fa-check"></i><b>7.2.2</b> Gradient descent</a></li>
<li class="chapter" data-level="7.2.3" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#conjugate-gradients"><i class="fa fa-check"></i><b>7.2.3</b> Conjugate gradients</a></li>
<li class="chapter" data-level="7.2.4" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#pep-moth-descent"><i class="fa fa-check"></i><b>7.2.4</b> Peppered Moths</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html"><i class="fa fa-check"></i><b>7.3</b> Newton-type algorithms</a><ul>
<li class="chapter" data-level="7.3.1" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html#poisson-regression"><i class="fa fa-check"></i><b>7.3.1</b> Poisson regression</a></li>
<li class="chapter" data-level="7.3.2" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html#quasi-newton-algorithms"><i class="fa fa-check"></i><b>7.3.2</b> Quasi-Newton algorithms</a></li>
<li class="chapter" data-level="7.3.3" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html#sparsity"><i class="fa fa-check"></i><b>7.3.3</b> Sparsity</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="7-4-misc-.html"><a href="7-4-misc-.html"><i class="fa fa-check"></i><b>7.4</b> Misc.</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-em.html"><a href="8-em.html"><i class="fa fa-check"></i><b>8</b> Expectation maximization algorithms</a><ul>
<li class="chapter" data-level="8.1" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html"><i class="fa fa-check"></i><b>8.1</b> Basic properties</a><ul>
<li class="chapter" data-level="8.1.1" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html#incomplete-data-likelihood"><i class="fa fa-check"></i><b>8.1.1</b> Incomplete data likelihood</a></li>
<li class="chapter" data-level="8.1.2" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html#monotonicity-of-the-em-algorithm"><i class="fa fa-check"></i><b>8.1.2</b> Monotonicity of the EM algorithm</a></li>
<li class="chapter" data-level="8.1.3" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html#peppered-moths"><i class="fa fa-check"></i><b>8.1.3</b> Peppered moths</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-2-EM-exp.html"><a href="8-2-EM-exp.html"><i class="fa fa-check"></i><b>8.2</b> Exponential families</a></li>
<li class="chapter" data-level="8.3" data-path="8-3-fisher-information.html"><a href="8-3-fisher-information.html"><i class="fa fa-check"></i><b>8.3</b> Fisher information</a></li>
<li class="chapter" data-level="8.4" data-path="8-4-revisiting-gaussian-mixtures.html"><a href="8-4-revisiting-gaussian-mixtures.html"><i class="fa fa-check"></i><b>8.4</b> Revisiting Gaussian mixtures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-StochOpt.html"><a href="9-StochOpt.html"><i class="fa fa-check"></i><b>9</b> Stochastic Optimization</a><ul>
<li class="chapter" data-level="9.1" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html"><i class="fa fa-check"></i><b>9.1</b> Stochastic gradient algorithms</a><ul>
<li class="chapter" data-level="9.1.1" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html#section"><i class="fa fa-check"></i><b>9.1.1</b> </a></li>
<li class="chapter" data-level="9.1.2" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html#online-stochastic-gradient-descent"><i class="fa fa-check"></i><b>9.1.2</b> Online stochastic gradient descent</a></li>
<li class="chapter" data-level="9.1.3" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html#stochastic-gradient-descent"><i class="fa fa-check"></i><b>9.1.3</b> Stochastic gradient descent</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="9-2-nonlinear-least-squares.html"><a href="9-2-nonlinear-least-squares.html"><i class="fa fa-check"></i><b>9.2</b> Nonlinear least squares</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="A-app-R.html"><a href="A-app-R.html"><i class="fa fa-check"></i><b>A</b> R programming</a><ul>
<li class="chapter" data-level="A.1" data-path="A-1-functions.html"><a href="A-1-functions.html"><i class="fa fa-check"></i><b>A.1</b> Functions</a><ul>
<li class="chapter" data-level="A.1.1" data-path="A-1-functions.html"><a href="A-1-functions.html#vectorization"><i class="fa fa-check"></i><b>A.1.1</b> Vectorization</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="A-2-objects-and-methods.html"><a href="A-2-objects-and-methods.html"><i class="fa fa-check"></i><b>A.2</b> Objects and methods</a></li>
<li class="chapter" data-level="A.3" data-path="A-3-environments.html"><a href="A-3-environments.html"><i class="fa fa-check"></i><b>A.3</b> Environments</a><ul>
<li class="chapter" data-level="A.3.1" data-path="A-3-environments.html"><a href="A-3-environments.html#function-factories"><i class="fa fa-check"></i><b>A.3.1</b> Function factories</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="A-4-performance.html"><a href="A-4-performance.html"><i class="fa fa-check"></i><b>A.4</b> Performance</a><ul>
<li class="chapter" data-level="A.4.1" data-path="A-4-performance.html"><a href="A-4-performance.html#parallel-computations"><i class="fa fa-check"></i><b>A.4.1</b> Parallel computations</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html"><i class="fa fa-check"></i><b>A.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#histograms-with-non-equidistant-breaks"><i class="fa fa-check"></i>Histograms with non-equidistant breaks</a></li>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#functions-and-objects"><i class="fa fa-check"></i>Functions and objects</a></li>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#functions-and-environments"><i class="fa fa-check"></i>Functions and environments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="network" class="section level2">
<h2><span class="header-section-number">5.3</span> Network failure</h2>
<p>In this section we consider a more serious application of importance
sampling. Though still a toy example, where we can find an exact solution,
the example illustrates well the type of application where we want to
approximate a small probability using a Monte Carlo average. Importance sampling can
then increase the probability of the rare event and as a result make the
variance of the Monte Carlo average smaller.</p>
<p>We will consider the following network consisting of ten nodes and with some of
the nodes connected.</p>
<p><img src="figures/networkfig.png" width="85%" style="display: block; margin: auto;" /></p>
<p>The network could be a computer network with ten computers. The different
connections (edges) may “fail” independently with probability <span class="math inline">\(p\)</span>, and
we ask the question: what is the probability that node 1 and node 10 are disconnected?</p>
<p>We can answer this question by computing an integral of an indicator
function, that is, by computing the sum
<span class="math display">\[\mu = \sum_{x \in \{0,1\}^{18}} 1_B(x) f_p(x)\]</span>
where <span class="math inline">\(f_p(x)\)</span> is the point probability of <span class="math inline">\(x\)</span>, with <span class="math inline">\(x\)</span> representing which of the 18 edges
in the graph that fail, and <span class="math inline">\(B\)</span> represents the set of edges where node 1 and node 10 are
disconnected. By simulating edge failures we can approximate the sum as a
Monte Carlo average.</p>
<p>The network of nodes can be represented as a graph adjacency matrix <span class="math inline">\(A\)</span> such
that <span class="math inline">\(A_{ij} = 1\)</span> if and only if there is an edge between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> (and <span class="math inline">\(A_{ij} = 0\)</span>
otherwise).</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="5-3-network.html#cb217-1"></a>A  <span class="co"># Graph adjacency matrix</span></span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    0    1    0    1    1    0    0    0    0     0
##  [2,]    1    0    1    0    0    1    0    0    0     0
##  [3,]    0    1    0    0    0    1    1    1    0     1
##  [4,]    1    0    0    0    1    0    0    1    0     0
##  [5,]    1    0    0    1    0    0    0    1    1     0
##  [6,]    0    1    1    0    0    0    1    0    0     1
##  [7,]    0    0    1    0    0    1    0    0    0     1
##  [8,]    0    0    1    1    1    0    0    0    1     0
##  [9,]    0    0    0    0    1    0    0    1    0     1
## [10,]    0    0    1    0    0    1    1    0    1     0</code></pre>
<p>To compute the probability that 1 and 10 are disconnected by Monte Carlo
integration, we need to sample (sub)graphs by randomly removing some of the
edges. This is implemented using the upper triangular part of the (symmetric)
adjacency matrix.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="5-3-network.html#cb219-1"></a>sim_net &lt;-<span class="st"> </span><span class="cf">function</span>(Aup, p) {</span>
<span id="cb219-2"><a href="5-3-network.html#cb219-2"></a>  ones &lt;-<span class="st"> </span><span class="kw">which</span>(Aup <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb219-3"><a href="5-3-network.html#cb219-3"></a>  Aup[ones] &lt;-<span class="st"> </span><span class="kw">sample</span>(</span>
<span id="cb219-4"><a href="5-3-network.html#cb219-4"></a>    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb219-5"><a href="5-3-network.html#cb219-5"></a>    <span class="kw">length</span>(ones), </span>
<span id="cb219-6"><a href="5-3-network.html#cb219-6"></a>    <span class="dt">replace =</span> <span class="ot">TRUE</span>,</span>
<span id="cb219-7"><a href="5-3-network.html#cb219-7"></a>    <span class="dt">prob =</span> <span class="kw">c</span>(p, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)</span>
<span id="cb219-8"><a href="5-3-network.html#cb219-8"></a>  )</span>
<span id="cb219-9"><a href="5-3-network.html#cb219-9"></a>  Aup </span>
<span id="cb219-10"><a href="5-3-network.html#cb219-10"></a>}</span></code></pre></div>
<p>The core of the implementation above uses the <code>sample()</code> function, which
can sample with replacement from the set <span class="math inline">\(\{0, 1\}\)</span>. The vector <code>ones</code>
contains indices of the (upper triangular part of the) adjacency matrix
containing a <code>1</code>, and these positions are replaced by the sampled values before
the matrix is returned.</p>
<p>It is fairly fast to sample even a large number of random graphs this way.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="5-3-network.html#cb220-1"></a>Aup &lt;-<span class="st"> </span>A</span>
<span id="cb220-2"><a href="5-3-network.html#cb220-2"></a>Aup[<span class="kw">lower.tri</span>(Aup)] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb220-3"><a href="5-3-network.html#cb220-3"></a><span class="kw">system.time</span>(<span class="kw">replicate</span>(<span class="fl">1e5</span>, {<span class="kw">sim_net</span>(Aup, <span class="fl">0.5</span>); <span class="ot">NULL</span>}))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.396   0.094   1.506</code></pre>
<p>The second function we implement checks network connectivity based on
the upper triangular part of the adjacency matrix.
It relies on the fact that there is a path from node 1 to node 10 consisting
of <span class="math inline">\(k\)</span> edges if and only if <span class="math inline">\((A^k)_{1,10} &gt; 0\)</span>. We see directly that such a
path needs to consist of at least <span class="math inline">\(k = 3\)</span> edges. Also, we don’t need to
check paths with more than <span class="math inline">\(k = 9\)</span> edges as they will contain the one node
multiple times and can thus be shortened.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="5-3-network.html#cb222-1"></a>discon &lt;-<span class="st"> </span><span class="cf">function</span>(Aup) {</span>
<span id="cb222-2"><a href="5-3-network.html#cb222-2"></a>  A &lt;-<span class="st"> </span>Aup <span class="op">+</span><span class="st"> </span><span class="kw">t</span>(Aup)</span>
<span id="cb222-3"><a href="5-3-network.html#cb222-3"></a>  i &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb222-4"><a href="5-3-network.html#cb222-4"></a>  Apow &lt;-<span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>A <span class="op">%*%</span><span class="st"> </span>A <span class="co"># A%^%3</span></span>
<span id="cb222-5"><a href="5-3-network.html#cb222-5"></a>  <span class="cf">while</span>(Apow[<span class="dv">1</span>, <span class="dv">10</span>] <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>i <span class="op">&lt;</span><span class="st"> </span><span class="dv">9</span>) {</span>
<span id="cb222-6"><a href="5-3-network.html#cb222-6"></a>    Apow &lt;-<span class="st"> </span>Apow <span class="op">%*%</span><span class="st"> </span>A</span>
<span id="cb222-7"><a href="5-3-network.html#cb222-7"></a>    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>    </span>
<span id="cb222-8"><a href="5-3-network.html#cb222-8"></a>  }</span>
<span id="cb222-9"><a href="5-3-network.html#cb222-9"></a>  Apow[<span class="dv">1</span>, <span class="dv">10</span>] <span class="op">==</span><span class="st"> </span><span class="dv">0</span>  <span class="co"># TRUE if nodes 1 and 10 not connected</span></span>
<span id="cb222-10"><a href="5-3-network.html#cb222-10"></a>}</span></code></pre></div>
<p>We then obtain the following estimate of the probability of nodes 1 and 10 being
disconnected using Monte Carlo integration.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="5-3-network.html#cb223-1"></a>seed &lt;-<span class="st"> </span><span class="dv">27092016</span></span>
<span id="cb223-2"><a href="5-3-network.html#cb223-2"></a><span class="kw">set.seed</span>(seed)</span>
<span id="cb223-3"><a href="5-3-network.html#cb223-3"></a>n &lt;-<span class="st"> </span><span class="fl">1e5</span></span>
<span id="cb223-4"><a href="5-3-network.html#cb223-4"></a>tmp &lt;-<span class="st"> </span><span class="kw">replicate</span>(n, <span class="kw">discon</span>(<span class="kw">sim_net</span>(Aup, <span class="fl">0.05</span>)))</span>
<span id="cb223-5"><a href="5-3-network.html#cb223-5"></a>mu_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(tmp)</span></code></pre></div>
<p>As this is a random approximation, we should report not only the Monte Carlo
estimate but also the confidence interval. Since the estimate is an average of
0-1-variables, we can estimate the variance, <span class="math inline">\(\sigma^2\)</span>, of the individual terms
using that <span class="math inline">\(\sigma^2 = \mu (1 - \mu)\)</span>. We could just as well have used the
empirical variance, which would give almost the same numerical value
as <span class="math inline">\(\hat{\mu} (1 - \hat{\mu})\)</span>, but we use the latter estimator to illustrate
that any (good) estimator of <span class="math inline">\(\sigma^2\)</span> can be used when estimating the asymptotic
variance.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="5-3-network.html#cb224-1"></a>mu_hat <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(mu_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu_hat) <span class="op">/</span><span class="st"> </span>n) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.000226 0.000340 0.000454</code></pre>
<p>The estimated probability is low and only in about 1 of 3000 simulated graphs
will node 1 and 10 be disconnected. This suggests that importance sampling
can be useful if we sample from a probability distribution with a larger
probability of edge failure.</p>
<p>To implement importance sampling we note that the point probabilities
(the density w.r.t. counting measure) for sampling the 18 independent 0-1-variables
<span class="math inline">\(x = (x_1, \ldots, x_{18})\)</span> with <span class="math inline">\(P(X_i = 0) = p\)</span> is</p>
<p><span class="math display">\[f_p(x) = p^{18 - s} (1- p)^{s}\]</span></p>
<p>where <span class="math inline">\(s = \sum_{i=1}^{18} x_i\)</span>. In the implementation,
weights are computed that correspond to using probability <span class="math inline">\(p_0\)</span> (with density <span class="math inline">\(g = f_{p_0}\)</span>)
instead of <span class="math inline">\(p\)</span>, and the weights are only computed if node 1
and 10 are disconnected.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="5-3-network.html#cb226-1"></a>weights &lt;-<span class="st"> </span><span class="cf">function</span>(Aup, Aup0, p0, p) {</span>
<span id="cb226-2"><a href="5-3-network.html#cb226-2"></a>  w &lt;-<span class="st"> </span><span class="kw">discon</span>(Aup0)</span>
<span id="cb226-3"><a href="5-3-network.html#cb226-3"></a>  <span class="cf">if</span> (w) {</span>
<span id="cb226-4"><a href="5-3-network.html#cb226-4"></a>    s &lt;-<span class="st"> </span><span class="kw">sum</span>(Aup0)</span>
<span id="cb226-5"><a href="5-3-network.html#cb226-5"></a>    w &lt;-<span class="st"> </span>(p <span class="op">/</span><span class="st"> </span>p0)<span class="op">^</span><span class="dv">18</span> <span class="op">*</span><span class="st"> </span>(p0 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">/</span><span class="st"> </span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p0)))<span class="op">^</span>s</span>
<span id="cb226-6"><a href="5-3-network.html#cb226-6"></a>  }</span>
<span id="cb226-7"><a href="5-3-network.html#cb226-7"></a>  <span class="kw">as.numeric</span>(w)</span>
<span id="cb226-8"><a href="5-3-network.html#cb226-8"></a>}</span></code></pre></div>
<p>The implementation uses the formula</p>
<p><span class="math display">\[
w(x) = \frac{f_p(x)}{f_{p_0}(x)} = \frac{p^{18 - s} (1- p)^{s}}{p_0^{18 - s} (1- p_0)^{s}} = 
\left(\frac{p}{p_0}\right)^{18} \left(\frac{p_0 (1- p)}{p (1- p_0)}\right)^s.
\]</span></p>
<p>The importance sampling estimate of <span class="math inline">\(\mu\)</span> is then computed.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="5-3-network.html#cb227-1"></a><span class="kw">set.seed</span>(seed)</span>
<span id="cb227-2"><a href="5-3-network.html#cb227-2"></a>tmp &lt;-<span class="st"> </span><span class="kw">replicate</span>(n, <span class="kw">weights</span>(Aup, <span class="kw">sim_net</span>(Aup, <span class="fl">0.2</span>), <span class="fl">0.2</span>, <span class="fl">0.05</span>))</span>
<span id="cb227-3"><a href="5-3-network.html#cb227-3"></a>mu_hat_IS &lt;-<span class="st"> </span><span class="kw">mean</span>(tmp)</span></code></pre></div>
<p>And we obtain the following confidence interval using the
empirical variance estimate <span class="math inline">\(\hat{\sigma}^2\)</span>.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="5-3-network.html#cb228-1"></a>mu_hat_IS <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(tmp) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n) <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.000262 0.000296 0.000330</code></pre>
<p>The ratio of estimated variances for the plain Monte Carlo estimate and the
importance sampling estimate is</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="5-3-network.html#cb230-1"></a>mu_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu_hat) <span class="op">/</span><span class="st"> </span><span class="kw">var</span>(tmp)</span></code></pre></div>
<pre><code>## [1] 11.22476</code></pre>
<p>Thus we need around 11 times more samples
if using plain Monte Carlo integration when compared to importance sampling to obtain the same precision.
A benchmark will show that the extra computing time for importance sampling is small compared
to the reduction of variance.
It is therefore worth the coding effort if used repeatedly, but not
if it is a one-off computation.</p>
<p>The graph is, in fact, small enough for complete enumeration and thus the computation
of an exact solution. There are <span class="math inline">\(2^{18} = 262,144\)</span> different networks with
any number of the edges failing. To
systematically walk through all possible combinations of edges failing,
we use the function <code>intToBits</code> that converts an integer to its binary
representation for integers from 0 to 262,143. This is a quick and convenient
way of representing all the different fail and non-fail combinations
for the edges.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="5-3-network.html#cb232-1"></a>ones &lt;-<span class="st"> </span><span class="kw">which</span>(Aup <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb232-2"><a href="5-3-network.html#cb232-2"></a>Atmp &lt;-<span class="st"> </span>Aup</span>
<span id="cb232-3"><a href="5-3-network.html#cb232-3"></a>p &lt;-<span class="st"> </span><span class="fl">0.05</span></span>
<span id="cb232-4"><a href="5-3-network.html#cb232-4"></a>prob &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">2</span><span class="op">^</span><span class="dv">18</span>)</span>
<span id="cb232-5"><a href="5-3-network.html#cb232-5"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>(<span class="dv">2</span><span class="op">^</span><span class="dv">18</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) {</span>
<span id="cb232-6"><a href="5-3-network.html#cb232-6"></a>  on &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">intToBits</span>(i)[<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>])</span>
<span id="cb232-7"><a href="5-3-network.html#cb232-7"></a>  Atmp[ones] &lt;-<span class="st"> </span>on</span>
<span id="cb232-8"><a href="5-3-network.html#cb232-8"></a>  <span class="cf">if</span> (<span class="kw">discon</span>(Atmp)) {</span>
<span id="cb232-9"><a href="5-3-network.html#cb232-9"></a>    s &lt;-<span class="st"> </span><span class="kw">sum</span>(on)</span>
<span id="cb232-10"><a href="5-3-network.html#cb232-10"></a>    prob[i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span>p<span class="op">^</span>(<span class="dv">18</span> <span class="op">-</span><span class="st"> </span>s) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)<span class="op">^</span>s</span>
<span id="cb232-11"><a href="5-3-network.html#cb232-11"></a>  }</span>
<span id="cb232-12"><a href="5-3-network.html#cb232-12"></a>}</span></code></pre></div>
<p>The probability that nodes 1 and 10 are disconnected can then be computed as
the sum of all the probabilities in <code>prob</code>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="5-3-network.html#cb233-1"></a><span class="kw">sum</span>(prob)</span></code></pre></div>
<pre><code>## [1] 0.000288295</code></pre>
<p>This number should be compared to the estimates computed above. For a more complete
comparison, we have used importance sampling with edge fail probability
ranging from 0.1 to 0.4, see Figure <a href="5-3-network.html#fig:networkImp">5.6</a>. The results
show that a failure probability of 0.2 is close to optimal in terms of
giving an importance sampling estimate with minimal variance. For smaller
values, the event that 1 and 10 become disconnected is too rare, and for
larger values the importance weights become too variable. A choice of 0.2
strikes a good balance.</p>

<div class="figure" style="text-align: center"><span id="fig:networkImp"></span>
<img src="CSwR_files/figure-html/networkImp-1.png" alt="Confidence intervals for importance sampling estimates of network nodes 1 and 10 being disconnected under independent edge failures with probability 0.05. The red line is the true probability computed by complete enumeration." width="70%" />
<p class="caption">
Figure 5.6: Confidence intervals for importance sampling estimates of network nodes 1 and 10 being disconnected under independent edge failures with probability 0.05. The red line is the true probability computed by complete enumeration.
</p>
</div>
<div id="object-oriented-implementations" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Object oriented implementations</h3>
<p>Implementations of algorithms that handle graphs and simulate graphs, as in the Monte Carlo
computations above, can benefit from using an object oriented approach. To
this end we first implement a so-called <em>constructor</em>, which is a function
that takes the adjacency matrix and the edge failure probability as arguments and
returns a list with class label <code>network</code>.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="5-3-network.html#cb235-1"></a>network &lt;-<span class="st"> </span><span class="cf">function</span>(A, p) {</span>
<span id="cb235-2"><a href="5-3-network.html#cb235-2"></a>  Aup &lt;-<span class="st"> </span>A</span>
<span id="cb235-3"><a href="5-3-network.html#cb235-3"></a>  Aup[<span class="kw">lower.tri</span>(Aup)] &lt;-<span class="st"> </span><span class="dv">0</span> </span>
<span id="cb235-4"><a href="5-3-network.html#cb235-4"></a>  ones &lt;-<span class="st"> </span><span class="kw">which</span>((Aup <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb235-5"><a href="5-3-network.html#cb235-5"></a>  <span class="kw">structure</span>(</span>
<span id="cb235-6"><a href="5-3-network.html#cb235-6"></a>    <span class="kw">list</span>(</span>
<span id="cb235-7"><a href="5-3-network.html#cb235-7"></a>      <span class="dt">A =</span> A, </span>
<span id="cb235-8"><a href="5-3-network.html#cb235-8"></a>      <span class="dt">Aup =</span> Aup, </span>
<span id="cb235-9"><a href="5-3-network.html#cb235-9"></a>      <span class="dt">ones =</span> ones, </span>
<span id="cb235-10"><a href="5-3-network.html#cb235-10"></a>      <span class="dt">p =</span> p</span>
<span id="cb235-11"><a href="5-3-network.html#cb235-11"></a>    ), </span>
<span id="cb235-12"><a href="5-3-network.html#cb235-12"></a>    <span class="dt">class =</span> <span class="st">&quot;network&quot;</span></span>
<span id="cb235-13"><a href="5-3-network.html#cb235-13"></a>  )</span>
<span id="cb235-14"><a href="5-3-network.html#cb235-14"></a>}</span></code></pre></div>
<p>We use the constructor function <code>network()</code> to construct and object of class
<code>network</code> for our specific adjacency matrix.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="5-3-network.html#cb236-1"></a>my_net &lt;-<span class="st"> </span><span class="kw">network</span>(A, <span class="dt">p =</span> <span class="fl">0.05</span>)</span>
<span id="cb236-2"><a href="5-3-network.html#cb236-2"></a><span class="kw">str</span>(my_net) </span></code></pre></div>
<pre><code>## List of 4
##  $ A   : num [1:10, 1:10] 0 1 0 1 1 0 0 0 0 0 ...
##  $ Aup : num [1:10, 1:10] 0 0 0 0 0 0 0 0 0 0 ...
##  $ ones: int [1:18] 11 22 31 41 44 52 53 63 66 73 ...
##  $ p   : num 0.05
##  - attr(*, &quot;class&quot;)= chr &quot;network&quot;</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="5-3-network.html#cb238-1"></a><span class="kw">class</span>(my_net)</span></code></pre></div>
<pre><code>## [1] &quot;network&quot;</code></pre>
<p>The network object contains, in addition to <code>A</code> and <code>p</code>, two precomputed components:
the upper triangular part of the adjacency matrix; and the indices in that matrix
containing a <code>1</code>.</p>
<p>The intention is then to write two methods for the network class. A method <code>sim()</code> that will
simulate a graph where some edges have failed, and a method <code>failure()</code> that will
estimate the probability of node 1 and 10 being disconnected by Monte Carlo
integration. To do so we need to define the two corresponding generic functions.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="5-3-network.html#cb240-1"></a>sim &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...)</span>
<span id="cb240-2"><a href="5-3-network.html#cb240-2"></a>  <span class="kw">UseMethod</span>(<span class="st">&quot;sim&quot;</span>)</span>
<span id="cb240-3"><a href="5-3-network.html#cb240-3"></a>failure &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...)</span>
<span id="cb240-4"><a href="5-3-network.html#cb240-4"></a>  <span class="kw">UseMethod</span>(<span class="st">&quot;failure&quot;</span>)</span></code></pre></div>
<p>The method for simulation is then implemented as a function with name
<code>sim.network</code>.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="5-3-network.html#cb241-1"></a>sim.network &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb241-2"><a href="5-3-network.html#cb241-2"></a>  Aup &lt;-<span class="st"> </span>x<span class="op">$</span>Aup</span>
<span id="cb241-3"><a href="5-3-network.html#cb241-3"></a>  Aup[x<span class="op">$</span>ones] &lt;-<span class="st"> </span><span class="kw">sample</span>(</span>
<span id="cb241-4"><a href="5-3-network.html#cb241-4"></a>    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb241-5"><a href="5-3-network.html#cb241-5"></a>    <span class="kw">length</span>(x<span class="op">$</span>ones), </span>
<span id="cb241-6"><a href="5-3-network.html#cb241-6"></a>    <span class="dt">replace =</span> <span class="ot">TRUE</span>, </span>
<span id="cb241-7"><a href="5-3-network.html#cb241-7"></a>    <span class="dt">prob =</span> <span class="kw">c</span>(x<span class="op">$</span>p, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x<span class="op">$</span>p)</span>
<span id="cb241-8"><a href="5-3-network.html#cb241-8"></a>  )</span>
<span id="cb241-9"><a href="5-3-network.html#cb241-9"></a>  Aup</span>
<span id="cb241-10"><a href="5-3-network.html#cb241-10"></a>}</span></code></pre></div>
<p>It is implemented using essentially the same implementation as <code>sim_net()</code>
except that <code>Aup</code> and <code>p</code> are extracted as components from the object <code>x</code>
instead of being arguments, and <code>ones</code> is extracted from <code>x</code> as well instead
of being computed. One could argue that the <code>sim()</code> method should return an object
of class network — that would be natural. However, then we need to call the<br />
constructor with the full adjacency matrix, this will take some time and we do
not want to do that as a default. Thus we simply return the upper triangular
part of the adjacency matrix from <code>sim()</code>.</p>
<p>The <code>failure()</code> method implements plain Monte Carlo integration as well
as importance sampling and returns a vector containing the estimate as
well as the 95% confidence interval. This implementation relies on the
already implemented functions <code>discon()</code> and <code>weights()</code>.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="5-3-network.html#cb242-1"></a>failure.network &lt;-<span class="st"> </span><span class="cf">function</span>(x, n, <span class="dt">p0 =</span> <span class="ot">NULL</span>) {</span>
<span id="cb242-2"><a href="5-3-network.html#cb242-2"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(p0)) { </span>
<span id="cb242-3"><a href="5-3-network.html#cb242-3"></a>    <span class="co"># Plain Monte Carlo simulation</span></span>
<span id="cb242-4"><a href="5-3-network.html#cb242-4"></a>    tmp &lt;-<span class="st"> </span><span class="kw">replicate</span>(n, <span class="kw">discon</span>(<span class="kw">sim</span>(x)))</span>
<span id="cb242-5"><a href="5-3-network.html#cb242-5"></a>    mu_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(tmp)</span>
<span id="cb242-6"><a href="5-3-network.html#cb242-6"></a>    se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(mu_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mu_hat) <span class="op">/</span><span class="st"> </span>n)</span>
<span id="cb242-7"><a href="5-3-network.html#cb242-7"></a>  } <span class="cf">else</span> { </span>
<span id="cb242-8"><a href="5-3-network.html#cb242-8"></a>    <span class="co"># Importance sampling</span></span>
<span id="cb242-9"><a href="5-3-network.html#cb242-9"></a>    p &lt;-<span class="st"> </span>x<span class="op">$</span>p</span>
<span id="cb242-10"><a href="5-3-network.html#cb242-10"></a>    x<span class="op">$</span>p &lt;-<span class="st"> </span>p0</span>
<span id="cb242-11"><a href="5-3-network.html#cb242-11"></a>    tmp &lt;-<span class="st"> </span><span class="kw">replicate</span>(n, <span class="kw">weights</span>(x<span class="op">$</span>Aup, <span class="kw">sim</span>(x), p0, p))</span>
<span id="cb242-12"><a href="5-3-network.html#cb242-12"></a>    se &lt;-<span class="st"> </span><span class="kw">sd</span>(tmp) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)</span>
<span id="cb242-13"><a href="5-3-network.html#cb242-13"></a>    mu_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(tmp)</span>
<span id="cb242-14"><a href="5-3-network.html#cb242-14"></a>  } </span>
<span id="cb242-15"><a href="5-3-network.html#cb242-15"></a>  value &lt;-<span class="st"> </span>mu_hat <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)  </span>
<span id="cb242-16"><a href="5-3-network.html#cb242-16"></a>  <span class="kw">names</span>(value) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;estimate&quot;</span>, <span class="st">&quot;high&quot;</span>)</span>
<span id="cb242-17"><a href="5-3-network.html#cb242-17"></a>  value</span>
<span id="cb242-18"><a href="5-3-network.html#cb242-18"></a>}</span></code></pre></div>
<p>We test the implementation against the previously computed results.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="5-3-network.html#cb243-1"></a><span class="kw">set.seed</span>(seed)  <span class="co"># Resetting seed</span></span>
<span id="cb243-2"><a href="5-3-network.html#cb243-2"></a><span class="kw">failure</span>(my_net, n)</span></code></pre></div>
<pre><code>##      low estimate     high 
## 0.000226 0.000340 0.000454</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="5-3-network.html#cb245-1"></a><span class="kw">set.seed</span>(seed)  <span class="co"># Resetting seed</span></span>
<span id="cb245-2"><a href="5-3-network.html#cb245-2"></a><span class="kw">failure</span>(my_net, n, <span class="dt">p0 =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>##      low estimate     high 
## 0.000262 0.000296 0.000330</code></pre>
<p>We find that these are the same numbers as computed above, thus the object
oriented implementation concurs with the non-object oriented on this example.</p>
<p>We benchmark the object oriented implementation to measure if there is
any run time loss or improvement due to using objects.
One should expect a small computational overhead due to method dispatching,
that is, the procedure that R uses to look up the appropriate <code>sim()</code> method
for an object of class <code>network</code>. On the other hand, <code>sim()</code> does not recompute
<code>ones</code> every time.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="5-3-network.html#cb247-1"></a><span class="kw">microbenchmark</span>(</span>
<span id="cb247-2"><a href="5-3-network.html#cb247-2"></a>  <span class="kw">sim_net</span>(Aup, <span class="fl">0.05</span>),</span>
<span id="cb247-3"><a href="5-3-network.html#cb247-3"></a>  <span class="kw">sim</span>(my_net),</span>
<span id="cb247-4"><a href="5-3-network.html#cb247-4"></a>  <span class="dt">times =</span> <span class="fl">1e4</span></span>
<span id="cb247-5"><a href="5-3-network.html#cb247-5"></a>)</span></code></pre></div>
<pre><code>## Unit: microseconds
##                expr  min    lq mean median   uq   max neval
##  sim_net(Aup, 0.05) 8.34  9.09 10.7   9.43 10.0   202 10000
##         sim(my_net) 9.30 10.13 12.8  10.49 11.1 10153 10000</code></pre>
<p>From the benchmark, the object oriented solution using <code>sim()</code> appears to be
a bit slower than <code>sim_net()</code> despite the latter recomputing <code>ones</code>, and
this can be explained by method dispatching taking of the order of 1 microsecond
during these benchmark computations.</p>
<p>Once we have taken an object oriented approach, we can also implement methods
for some standard generic functions, e.g. the <code>print</code> function. As this generic
function already exists, we simply need to implement a method for class <code>network</code>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="5-3-network.html#cb249-1"></a>print.network &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb249-2"><a href="5-3-network.html#cb249-2"></a>  <span class="kw">cat</span>(<span class="st">&quot;#vertices: &quot;</span>, <span class="kw">nrow</span>(x<span class="op">$</span>A), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb249-3"><a href="5-3-network.html#cb249-3"></a>  <span class="kw">cat</span>(<span class="st">&quot;#edges:&quot;</span>, <span class="kw">sum</span>(x<span class="op">$</span>Aup), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb249-4"><a href="5-3-network.html#cb249-4"></a>  <span class="kw">cat</span>(<span class="st">&quot;p = &quot;</span>, x<span class="op">$</span>p, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb249-5"><a href="5-3-network.html#cb249-5"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="5-3-network.html#cb250-1"></a>my_net  <span class="co"># Implicitly calls &#39;print&#39;</span></span></code></pre></div>
<pre><code>## #vertices:  10 
## #edges: 18 
## p =  0.05</code></pre>
<p>Our print method now prints out some summary information about the graph instead
of just the raw list.</p>
<p>If you want to work more seriously with graphs, it is likely that you want to use
an existing R package instead of reimplementing many graph algorithms. One of
these packages is igraph, which also illustrates well an object oriented implementation
of graph classes in R.</p>
<p>We start by constructing a new graph object from the adjacency matrix.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="5-3-network.html#cb252-1"></a><span class="kw">library</span>(igraph)</span>
<span id="cb252-2"><a href="5-3-network.html#cb252-2"></a>net &lt;-<span class="st"> </span><span class="kw">graph_from_adjacency_matrix</span>(A, <span class="dt">mode =</span> <span class="st">&quot;undirected&quot;</span>)</span>
<span id="cb252-3"><a href="5-3-network.html#cb252-3"></a><span class="kw">class</span>(net)</span></code></pre></div>
<pre><code>## [1] &quot;igraph&quot;</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="5-3-network.html#cb254-1"></a>net <span class="co"># Illustrates the print method for objects of class &#39;igraph&#39;</span></span></code></pre></div>
<pre><code>## IGRAPH 0429f5b U--- 10 18 -- 
## + edges from 0429f5b:
##  [1] 1-- 2 1-- 4 1-- 5 2-- 3 2-- 6 3-- 6 3-- 7 3-- 8 3--10 4-- 5 4-- 8 5-- 8
## [13] 5-- 9 6-- 7 6--10 7--10 8-- 9 9--10</code></pre>
<p>The igraph package supports a vast number of graph computation, manipulation and
visualization tools. We will here illustrate how igraph can be used to plot the
graph and how we can implement a simulation method for objects of class igraph.</p>
<p>You can use <code>plot(net)</code>, which will call the plot method for objects of class igraph.
But before doing so, we will specify a layout of the graph.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="5-3-network.html#cb256-1"></a><span class="co"># You can generate a layout ...</span></span>
<span id="cb256-2"><a href="5-3-network.html#cb256-2"></a>net_layout &lt;-<span class="st"> </span><span class="kw">layout_</span>(net, <span class="kw">nicely</span>())</span>
<span id="cb256-3"><a href="5-3-network.html#cb256-3"></a><span class="co"># ... or you can specify one yourself </span></span>
<span id="cb256-4"><a href="5-3-network.html#cb256-4"></a>net_layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb256-5"><a href="5-3-network.html#cb256-5"></a>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">20</span>,  <span class="dv">1</span>,</span>
<span id="cb256-6"><a href="5-3-network.html#cb256-6"></a>    <span class="dv">-4</span>,  <span class="dv">3</span>,</span>
<span id="cb256-7"><a href="5-3-network.html#cb256-7"></a>    <span class="dv">-4</span>,  <span class="dv">1</span>,</span>
<span id="cb256-8"><a href="5-3-network.html#cb256-8"></a>    <span class="dv">-4</span>, <span class="dv">-1</span>,</span>
<span id="cb256-9"><a href="5-3-network.html#cb256-9"></a>    <span class="dv">-4</span>, <span class="dv">-3</span>,</span>
<span id="cb256-10"><a href="5-3-network.html#cb256-10"></a>     <span class="dv">4</span>,  <span class="dv">3</span>,</span>
<span id="cb256-11"><a href="5-3-network.html#cb256-11"></a>     <span class="dv">4</span>,  <span class="dv">1</span>,</span>
<span id="cb256-12"><a href="5-3-network.html#cb256-12"></a>     <span class="dv">4</span>, <span class="dv">-1</span>,</span>
<span id="cb256-13"><a href="5-3-network.html#cb256-13"></a>     <span class="dv">4</span>, <span class="dv">-3</span>,</span>
<span id="cb256-14"><a href="5-3-network.html#cb256-14"></a>     <span class="dv">20</span>,  <span class="dv">-1</span>),</span>
<span id="cb256-15"><a href="5-3-network.html#cb256-15"></a>  <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>The layout we have specified makes it easy to recognize the graph.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="5-3-network.html#cb257-1"></a><span class="kw">plot</span>(net, <span class="dt">layout =</span> net_layout, <span class="dt">asp =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="CSwR_files/figure-html/network_plot-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We then use two functions from the igraph package to implement simulation of
a new graph. We need <code>gsize()</code>, which gives the number of edges in the graph,
and we need <code>delete_edges()</code>, which removes edges from the graph. Otherwise
the simulation is still based on <code>sample()</code>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="5-3-network.html#cb258-1"></a>sim.igraph &lt;-<span class="st"> </span><span class="cf">function</span>(x, p) {</span>
<span id="cb258-2"><a href="5-3-network.html#cb258-2"></a>  deledges &lt;-<span class="st"> </span><span class="kw">sample</span>(</span>
<span id="cb258-3"><a href="5-3-network.html#cb258-3"></a>    <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), </span>
<span id="cb258-4"><a href="5-3-network.html#cb258-4"></a>    <span class="kw">gsize</span>(x),        <span class="co"># &#39;gsize()&#39; returns the number of edges </span></span>
<span id="cb258-5"><a href="5-3-network.html#cb258-5"></a>    <span class="dt">replace =</span> <span class="ot">TRUE</span>, </span>
<span id="cb258-6"><a href="5-3-network.html#cb258-6"></a>    <span class="dt">prob =</span> <span class="kw">c</span>(p, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)</span>
<span id="cb258-7"><a href="5-3-network.html#cb258-7"></a>  )</span>
<span id="cb258-8"><a href="5-3-network.html#cb258-8"></a>  <span class="kw">delete_edges</span>(x, <span class="kw">which</span>(deledges))</span>
<span id="cb258-9"><a href="5-3-network.html#cb258-9"></a>}</span></code></pre></div>
<p>Note that this method is also called <code>sim()</code>, yet there is no conflict here with
the method for objects of class network because the generic <code>sim()</code> function
will delegate the call to the correct method based on the objects class label.</p>
<p>If we combine our new <code>sim()</code> method for igraphs with the plot method, we can
plot a simulated graph.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="5-3-network.html#cb259-1"></a><span class="kw">plot</span>(<span class="kw">sim</span>(net, <span class="fl">0.25</span>), <span class="dt">layout =</span> net_layout, <span class="dt">asp =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="CSwR_files/figure-html/network_simulated-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The implementation using igraph turns out to be a little slower than using
the matrix representation alone as in <code>sim_net()</code>.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="5-3-network.html#cb260-1"></a><span class="kw">system.time</span>(<span class="kw">replicate</span>(<span class="fl">1e5</span>, {<span class="kw">sim</span>(net, <span class="fl">0.05</span>); <span class="ot">NULL</span>}))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   4.118   1.993   6.151</code></pre>
<p>One could also implement the function for testing if nodes 1 and 10 are
disconnected using the <code>shortest_paths()</code> function, but this is not faster
than the simple matrix multiplications used in <code>discon()</code> either. However, one
should be careful not to draw any general conclusions from this. Our graph is
admittedly a small toy example, and we implemented our solutions largely
to handle this particular graph.</p>

</div>
</div>
<!-- </div> -->



</div>
            </section>

          </div>
        </div>
      </div>
<a href="5-2-importance-sampling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-four-examples.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
