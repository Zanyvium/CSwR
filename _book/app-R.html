<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A R programming | Computational Statistics with R</title>
<meta name="author" content="Niels Richard Hansen">
<meta name="description" content="This appendix on R programming is a brief overview of important programming constructs and concepts in R that are used in the book. For a detailed and much more extensive coverage of R as a...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="A R programming | Computational Statistics with R">
<meta property="og:type" content="book">
<meta property="og:description" content="This appendix on R programming is a brief overview of important programming constructs and concepts in R that are used in the book. For a detailed and much more extensive coverage of R as a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A R programming | Computational Statistics with R">
<meta name="twitter:description" content="This appendix on R programming is a brief overview of important programming constructs and concepts in R that are used in the book. For a detailed and much more extensive coverage of R as a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Roboto%20Slab-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Computational Statistics with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Part I: Smoothing</li>
<li><a class="" href="density.html"><span class="header-section-number">2</span> Density estimation</a></li>
<li><a class="" href="bivariate.html"><span class="header-section-number">3</span> Bivariate smoothing</a></li>
<li class="book-part">Part II: Monte Carlo Methods</li>
<li><a class="" href="univariate-random-variables.html"><span class="header-section-number">4</span> Univariate random variables</a></li>
<li><a class="" href="mci.html"><span class="header-section-number">5</span> Monte Carlo integration</a></li>
<li class="book-part">Part III: Optimization</li>
<li><a class="" href="four-examples.html"><span class="header-section-number">6</span> Four Examples</a></li>
<li><a class="" href="numopt.html"><span class="header-section-number">7</span> Numerical optimization</a></li>
<li><a class="" href="em.html"><span class="header-section-number">8</span> Expectation maximization algorithms</a></li>
<li><a class="" href="StochOpt.html"><span class="header-section-number">9</span> Stochastic Optimization</a></li>
<li class="book-part">Appendix</li>
<li><a class="active" href="app-R.html"><span class="header-section-number">A</span> R programming</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/nielsrhansen/CSwR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="app-R" class="section level1" number="10">
<h1>
<span class="header-section-number">A</span> R programming<a class="anchor" aria-label="anchor" href="#app-R"><i class="fas fa-link"></i></a>
</h1>
<p>This appendix on R programming is a brief overview of important
programming constructs and concepts in R that are used in the book.
For a detailed and much more
extensive coverage of R as a programming language the reader is referred to
the book <a href="https://adv-rapp-R.hadley.nz/">Advanced R</a>.</p>
<p>Depending on your background, the appendix can serve different purposes.
If you already have experience with programming in R, this appendix can serve
as a brush up on some basic aspects of the R language that are used throughout
the book. If you have experience with programming in other languages than R, it
can serve as an introduction to typical R programming techniques,
where some may differ from what you know from other languages. If you have little
prior experience with programming, this appendix can teach you the most important
things for getting started with the book, but you are encouraged to follow up
with additional and more detailed material like <a href="https://adv-r.hadley.nz/">Advanced R</a>.</p>
<p>For everybody, this appendix covers specific topics relevant for reading the book.
These topics include</p>
<ul>
<li>data types, comparisons and numerical precision</li>
<li>vectorized computations</li>
<li>functions, environments and function factories</li>
<li>performance assessment and improvement</li>
<li>S3 objects and methods</li>
</ul>
<p>Several important topics, such as
<a href="https://adv-r.hadley.nz/s4.html">S4</a> and
<a href="https://adv-r.hadley.nz/r6.html">R6</a> objects,
<a href="https://adv-r.hadley.nz/expressions.html">expressions</a>, and
<a href="https://r4ds.had.co.nz/wrangle-intro.html">data wrangling</a>, are not covered in
any detail. The book is on implementations of correct and efficient
numerical algorithms used in statistics, and this is reflected in the
topics covered in this appendix.</p>
<div id="app-data-structures" class="section level2" number="10.1">
<h2>
<span class="header-section-number">A.1</span> Data structures<a class="anchor" aria-label="anchor" href="#app-data-structures"><i class="fas fa-link"></i></a>
</h2>
<p>The fundamental data structure in R is a vector. Even variables that look and
behave like single numbers are vectors of length one. Vectors come in two flavors:
<em>atomic vectors</em> and <em>lists</em>.</p>
<p>An atomic vector is an indexed collection of data elements that are all
of the same type, e.g.</p>
<ul>
<li>integers</li>
<li>floating point numbers</li>
<li>logical values</li>
<li>character strings</li>
</ul>
<p>A list is an indexed collection of elements without any type restrictions on the
individual elements. An element in a list can, for instance, be a list itself.</p>
<div id="atomic-vectors" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">A.1.1</span> Atomic vectors<a class="anchor" aria-label="anchor" href="#atomic-vectors"><i class="fas fa-link"></i></a>
</h3>
<p>You can construct a vector in R by simply typing in its elements, e.g.Â </p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">first_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>  <span class="co"># Note the 'c'</span>
<span class="va">first_vector</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>The constructed vector contains the numbers 1, 2 and 3. We use the classical
assignment operator <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> throughout, while R supports using <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> if you prefer.
The <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> used on the right hand side of the assignment is short for <em>combine</em>
(or concatenate), and it is also used if you combine two vectors into one.</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">second_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">first_vector</span>, <span class="va">second_vector</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<p>There are several convenient techniques in R for constructing vectors of various
regular nature, e.g.Â sequences. The following example shows how to construct a
vector containing the integers from 1 to 10. The type of the vector is <code>integer</code>
indicating that the elements of the vector are stored as integers.</p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">integer_vector</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>
<span class="va">integer_vector</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">integer_vector</span><span class="op">)</span>  <span class="co"># `typeof` reveals the internal storage mode</span></code></pre></div>
<pre><code>## [1] "integer"</code></pre>
<p>We can access the individual elements as well as subsets of a vector
by indices using square brackets.</p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">integer_vector</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">integer_vector</span><span class="op">[</span><span class="va">first_vector</span><span class="op">]</span>  <span class="co"># The first three elements</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>The function <code>seq</code> generalizes the colon operator, <code>1:10</code>, as a way to
generate regular sequences. The following example shows how to generate
a sequence, <code>double_vector</code>, from 0.1 to 1.0 with increments of size 0.1.
The type of the resulting vector is <code>double</code>, which indicates that the elements
of <code>double_vector</code> are stored as doubles. That is, the numbers are stored as
floating point numbers using 64 bits of storage with a precision of
just about 16 digits.</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">double_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">double_vector</span></code></pre></div>
<pre><code>##  [1] 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0</code></pre>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">double_vector</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "double"</code></pre>
<p>Integers are often stored as or coerced into doubles automatically. The supposedly
integer vector, <code>first_vector</code>, is actually of type <code>double</code>.</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">first_vector</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "double"</code></pre>
<p>In R, numerical data of either type integer or double is collectively referred to
as <em>numerics</em> and have mode (and class) <code>numeric</code>. This is confusing, in particular
because ânumericâ is used also as pseudonym of the <em>type</em> double, but it is
rarely a practical problem. A vector of type integer or double is often just
said to by a <code>numeric</code>, and the function <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code> reflects this.</p>
<p>It is possible to insist that integers are actually stored as integers by
appending <code>L</code> to each integer, e.g.</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "integer"</code></pre>
<p>When sequences are generated using the colon operator with the endpoints being
integers, as in <code>1:10</code>, the result will be a vector of type integer. This is
an exception. Apparent integers are usually â and silently â converted into
doubles if they are not explicitly marked as integers by <code>L</code>.</p>
<p>Vectors of any length can be created by the generic function <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code>, or
by type specific functions such as <code><a href="https://rdrr.io/r/base/numeric.html">numeric()</a></code> that creates vectors of type
double.</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>Both vectors above are of type double and of length 10 and initialized with all
elements being 0.</p>
<p>A <em>logical vector</em> is another example of a useful atomic vector. The default
type of a vector created by <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code> is logical, with all elements being <code>FALSE</code>.</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<p>Logical vectors are encountered when we compare the elements of one vector
to another vector or to a number.</p>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logical_vector</span> <span class="op">&lt;-</span> <span class="va">integer_vector</span> <span class="op">&gt;</span> <span class="fl">4</span>
<span class="va">logical_vector</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">logical_vector</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "logical"</code></pre>
<p>While a logical vector has its own type and is stored efficiently as such,
it behaves in many ways as a numeric vector with <code>FALSE</code> equivalent
to 0 and <code>TRUE</code> equivalent to 1. If we want to compute the relative
frequency of elements in <code>integer_vector</code> that are are (strictly) larger than 4,
say, we can simply take the mean of <code>logical_vector</code>.</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">logical_vector</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.6</code></pre>
<p>The mean of a logical vector behaves as if the logical values are coerced into
zeros and ones before the mean is computed.</p>
<p>A final example of an atomic vector is a <em>character vector</em>. In this example,
the vector is combined from 6 individual strings to form a vector of length
6. Combining strings into a vector does not paste the strings together â it
forms a vector, whose elements are the individual strings.</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">character_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"vector"</span>, <span class="st">"of"</span>, <span class="st">"length"</span>, <span class="fl">6</span>, <span class="st">"."</span><span class="op">)</span>
<span class="va">character_vector</span></code></pre></div>
<pre><code>## [1] "A"      "vector" "of"     "length" "6"      "."</code></pre>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">character_vector</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>The type of the vector is character. Elements of a vector of type character
are strings. Note how the numeric value <code>6</code> in the construction of the vector was
automatically coerced into the string <code>"6"</code>.</p>
<p>It is possible to paste together the strings in a character vector.</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">character_vector</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>  <span class="co"># Now a character vector of length 1!</span></code></pre></div>
<pre><code>## [1] "A vector of length 6 ."</code></pre>
<p>It is likewise possible to split a string according to a pattern. For instance
into its individual characters.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">character_vector</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, split <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="co"># Split "vector" into characters</span></code></pre></div>
<pre><code>## [[1]]
## [1] "v" "e" "c" "t" "o" "r"</code></pre>
<p>Various additional string operations are available â see <code><a href="https://rdrr.io/r/base/character.html">?character</a></code> for
more information.</p>
<p>In summary, atomic vectors are the primitive data structures used in R,
with elements being accessible via indices (random access).
Typical vectors contain numbers, logical values or strings. There is no
declarations of data types â they are inferred from data
or computations. This is a flexible type system with many operations in R
silently coercing elements in a vector from one type to another.</p>
</div>
<div id="comparisons-and-numerical-precision" class="section level3" number="10.1.2">
<h3>
<span class="header-section-number">A.1.2</span> Comparisons and numerical precision<a class="anchor" aria-label="anchor" href="#comparisons-and-numerical-precision"><i class="fas fa-link"></i></a>
</h3>
<p>We can compare vectors using the equality operator <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code>, which compares
two vectors element-by-element. The result of the following comparison might
be a surprise at first sight.</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">double_vector</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 0.2 0.3</code></pre>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">double_vector</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE</code></pre>
<p>The result of the comparison is a vector of length 2 containing the logical
values <code>TRUE FALSE</code>, but <code>double_vector[2:3]</code> appears
to be equal to <code><a href="https://rdrr.io/r/base/c.html">c(0.2, 0.3)</a></code>. The difference shows up if we increase the number
of printed digits from the default (which is 7) to 20.</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2000000000000000111 0.2999999999999999889</code></pre>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">double_vector</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 0.20000000000000001110 0.30000000000000004441</code></pre>
<p>The 0.3 produced by <code>seq</code> is computed as <code>0.1 + 0.1 + 0.1</code>, while
the 0.3 in the vector <code><a href="https://rdrr.io/r/base/c.html">c(0.2, 0.3)</a></code> is converted directly into a double precision
number. The difference arises because neither 0.1 nor 0.3 are exactly representable
in the binary numeral system, and the arithmetic operations induce rounding
errors. The function <code>numToBits</code> can reveal the exact difference in the three
least significant bits.</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">numToBits</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> </code></pre></div>
<pre><code>## [1] 01 01 00</code></pre>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">numToBits</a></span><span class="op">(</span><span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> </code></pre></div>
<pre><code>## [1] 00 00 01</code></pre>
<p>Differences in the least significant bits are tolerable when we do numerical
computations but can be a nuisance for equality testing. When comparing vectors
containing doubles we are therefore often interested in testing for approximate
equality instead using e.g.Â </p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="va">double_vector</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The function <code>all.equal</code> has a tolerance argument controlling if numerical
differences will be regarded as actual differences. Another way of comparing
numerical vectors is by computing the range of their difference</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">double_vector</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.000000e+00 1.110223e-16</code></pre>
<p>This shows the largest positive and negative difference. Usually,
the size of the differences should be assessed relative to the magnitudes of
the numbers compared. For
numbers approximately of magnitude 1, differences
of the order <span class="math inline">\(2^{-52} \simeq 2.22 \times 10^{-16}\)</span> (the âmachine epsilonâ) can
safely be regarded as rounding errors. The default (relative) tolerance
of <code>all.equal</code> is the more permissive number <span class="math inline">\(\sqrt{2^{-53}} \simeq 1.5 \times 10^{-8}\)</span>.
This number is an <em>ad hoc</em> but commonly used tolerance. See <code><a href="https://rdrr.io/r/base/all.equal.html">?all.equal</a></code> for more details.</p>
</div>
<div id="lists" class="section level3" number="10.1.3">
<h3>
<span class="header-section-number">A.1.3</span> Lists<a class="anchor" aria-label="anchor" href="#lists"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="other-data-structures" class="section level3" number="10.1.4">
<h3>
<span class="header-section-number">A.1.4</span> Other data structures<a class="anchor" aria-label="anchor" href="#other-data-structures"><i class="fas fa-link"></i></a>
</h3>
<p>Factors, dates, data frames</p>
</div>
</div>
<div id="functions" class="section level2" number="10.2">
<h2>
<span class="header-section-number">A.2</span> Functions<a class="anchor" aria-label="anchor" href="#functions"><i class="fas fa-link"></i></a>
</h2>
<p>When you write an R script and source it, the different R expressions in the
script are evaluated sequentially. Intermediate results may be stored in variables
and used further down in the script. It may not be obvious, but all the expressions
in the script are, in fact, function calls. Your script relies on functions
implemented in either core R packages or in other installed packages.</p>
<p>It is possible to use R as a scripting language without ever writing your own
functions, but writing new R functions is how you extend the language, and
it is how you modularize and reuse your code in an efficient way. As a first
example, we implement the Gaussian kernel with bandwidth <span class="math inline">\(h\)</span> (see Section <a href="density.html#kernel-density">2.2</a>)
<span class="math display">\[K_h(x) = \frac{1}{h \sqrt{2 \pi}} e^{- \frac{x^2}{2h^2}}.\]</span>
We call the function <code>gauss()</code> to remind us that this is the Gaussian kernel.</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gauss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">h</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">h</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The <em>body</em> of the function is the R expression <code>exp(- x^2 / (2 * h^2)) / (h * sqrt(2 * pi))</code>.
When the function is called with specific numeric values of its two <em>formal arguments</em>
<code>x</code> and <code>h</code>, the body is evaluated with the formal arguments replaced by their
values. The value of the (last) evaluated expression in the body is returned by
the function. The bandwidth argument <code>h</code> is given a default value 1,
so if that argument is not specified when the function is called, it gets the
value 1.</p>
<p>The Gaussian kernel with bandwidth <span class="math inline">\(h\)</span> is the Gaussian density with standard
deviation <span class="math inline">\(h\)</span>. Thus we can compare our implementation with <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm()</a></code> in R
that computes the Gaussian density.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">gauss</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2419707 0.2419707</code></pre>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">gauss</span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0.1</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Bandwidth changed to 0.1</span></code></pre></div>
<pre><code>## [1] 2.419707 2.419707</code></pre>
<p>For those two cases the functions compute the same (at least, up to the printed
precision). Note how the formal argument <code>sd</code> is given the value <code>0.1</code> in
the second call of <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm()</a></code>. The argument <code>sd</code> is the third argument of <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm()</a></code>,
but we donât need to specify the second, as in <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0.1, 0, 0.1)</a></code>, to
specify the third. We can do so by its name, in which case the second argument
in <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm()</a></code> gets its default value <code>0</code>.</p>
<p>There are several alternative ways to implement the Gaussian kernel that
illustrate how functions can be written in R.</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A one-liner without curly brackets</span>
<span class="va">gauss_one_liner</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">h</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">h</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># A stepwise implementation computing the exponent first </span>
<span class="va">gauss_step</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">exponent</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">2</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">exponent</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">h</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># A stepwise implementation with an explicit return statement</span>
<span class="va">gauss_step_return</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">exponent</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="va">h</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">2</span>
  <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">exponent</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">h</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The following small test shows two cases where all implementations compute the
same.</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">gauss</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu">gauss_one_liner</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu">gauss_step</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu">gauss_step_return</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2419707 0.2419707 0.2419707 0.2419707</code></pre>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu">gauss</span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, 
  <span class="fu">gauss_one_liner</span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, 
  <span class="fu">gauss_step</span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>, 
  <span class="fu">gauss_step_return</span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## [1] 2.419707 2.419707 2.419707 2.419707</code></pre>
<p>A function should always be tested. A test is a comparison of the return value
of the function with the expected value for some specific argument(s). The
expected value can either be computed by hand or by another implementation â
as in the comparisons of <code>gauss()</code> and <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm()</a></code>. Such tests cannot prove
that the implementation is correct, but discrepancies can help you to catch and
correct bugs. Remember that when testing numerical computations that use floating
point numbers we cannot expect exact equality. Thus tests should reveal
if return values are within an acceptable tolerance of the expected results.</p>
<p>Larger pieces of software â such as an entire R package â should include
a number of tests of each function it implements. This is known as
<em>unit testing</em> (each unit, that is, each function, is tested), and there are
<a href="https://r-pkgs.org/tests.html">packages supporting</a> the systematic development
of unit tests for R package development. A comprehensive set of unit tests
also helps when functions are rewritten to e.g.Â improve performance or extend
functionality. If the rewritten function passes all tests, chances are that we
didnât break anything by rewriting the function.</p>
<p>It is good practice to write functions that do one well defined computation
and to keep the body of a function relatively small. Then it is easier to reason
about what the function does and it is easier to comprehensively test it.
Complex behavior is achieved by composing small and well tested functions.</p>
<p>To summarize:</p>
<ul>
<li>The body is enclosed by curly brackets <code>{}</code>, which may be left out if the
body is only one line.</li>
<li>The function returns the value of the last expression in the body except when
the body contains an explicit return statement.</li>
<li>Formal arguments can be given default values when the function is implemented,
and arguments can be passed to the function by position as well as by name.</li>
<li>Functions should do a single well defined computation and be well tested.</li>
</ul>
<div id="vectorization" class="section level3" number="10.2.1">
<h3>
<span class="header-section-number">A.2.1</span> Vectorization<a class="anchor" aria-label="anchor" href="#vectorization"><i class="fas fa-link"></i></a>
</h3>
<p>In Section <a href="app-R.html#app-data-structures">A.1</a> it was shown how comparison operators
work in a vectorized way. In R, comparing a vector to another vector or a
number leads to element-by-element comparisons with a logical vector as the result.
This is one example of how many operations and function evaluations in R are
natively vectorized, which means that when the function is evaluated with a
vector argument the function body is effectively evaluated for each entry in
the vector.</p>
<p>Our <code>gauss()</code> function is another example of a function that automatically
works as a vectorized function.</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">gauss</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2419707 2.4197072</code></pre>
<p>It works as expected for the vector input because all the functions in the body
of <code>gauss()</code> are vectorized, that is, the arithmetic operators are vectorized,
the square root is vectorized and the exponential function is vectorized.</p>
<p>It is good practice to write R programs that use vectorized computations whenever
possible. The alternative for-loop can be much slower. Several examples in the
book illustrate the computational benefits of vectorized implementations. It may,
however, not always be obvious how to correctly implement a vectorized function.</p>
<p>Suppose we want to implement the following function
<span class="math display">\[\overline{f}_h(x) =  \frac{1}{n} \sum_{i=1}^n K_h(x - x_i)\]</span>
for a data set <span class="math inline">\(x_1, \ldots, x_n\)</span> and <span class="math inline">\(K_h\)</span> the Gaussian kernel. This is the
Gaussian kernel density estimator considered in Section <a href="density.html#likelihood">2.4</a>. A
straight forward implementation is</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>  <span class="co"># A data set with 10 observations</span>
<span class="va">f_bar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span><span class="op">)</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">gauss</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">xs</span>, <span class="va">h</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This implementation works correctly when <code>x</code> and <code>h</code> are single numbers
but when e.g.Â <code>x</code> is a vector, the function returns a number (not a vector)
unrelated to <span class="math inline">\(\overline{f}_h(0)\)</span> and <span class="math inline">\(\overline{f}_h(1)\)</span>.</p>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">f_bar</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu">f_bar</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2289101 0.2434550</code></pre>
<div class="sourceCode" id="cb500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">f_bar</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># Computation is not vectorized</span></code></pre></div>
<pre><code>## [1] 0.2201532</code></pre>
<p>A quick fix is the following explicit vectorization</p>
<div class="sourceCode" id="cb502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f_bar_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize</a></span><span class="op">(</span><span class="va">f_bar</span><span class="op">)</span></code></pre></div>
<p>The R function <code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code> is a
<a href="https://adv-r.hadley.nz/function-operators.html">function operator</a>, which
takes a function as argument and returns a function. In this case a vectorized
version of the input function. That is, <code>f_bar_vec()</code> can be applied to a vector,
which results in applying <code>f_bar()</code> to each element of the vector. We test that <code>f_bar_vec()</code>
works correctly â both when the first and the second argument is given as
a vector.</p>
<div class="sourceCode" id="cb503"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">f_bar_vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2289101 0.2434550</code></pre>
<div class="sourceCode" id="cb505"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">f_bar</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu">f_bar</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Same result as the vectorized computation</span></code></pre></div>
<pre><code>## [1] 0.2289101 0.2434550</code></pre>
<div class="sourceCode" id="cb507"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">f_bar</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu">f_bar</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.2434550 0.4022502</code></pre>
<div class="sourceCode" id="cb509"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">f_bar_vec</span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Same result as the vectorized computation</span></code></pre></div>
<pre><code>## [1] 0.2434550 0.4022502</code></pre>
<p>The function <code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code> basically works by looping over
the elements in the vector argument(s) and applying the function to each element.
For prototyping and quick implementations it can be very convenient,
but it is not a shortcut to efficient vectorized computations.</p>
<p><code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code> is used in Section <a href="density.html#likelihood">2.4</a> to implement <span class="math inline">\(\overline{f}_h\)</span> based on
<code><a href="https://rdrr.io/r/stats/Normal.html">dnorm()</a></code>. The purpose of that implementation is to be able to compute
<span class="math inline">\(\overline{f}_h(x)\)</span> for arbitrary <span class="math inline">\(x\)</span> in a vectorized way, so that the function
can be used together with <code><a href="https://rdrr.io/r/graphics/curve.html">curve()</a></code> and in the likelihood computations of
that section. The implementations in Section <a href="density.html#dens-implement">2.2.1</a> differ by
computing and returning
<span class="math display">\[\overline{f}_h(\tilde{x}_1), \ldots, \overline{f}_h(\tilde{x}_m).\]</span>
That is, those implementations return the evaluations of <span class="math inline">\(\overline{f}_h\)</span> in
an equidistant grid <span class="math inline">\(\tilde{x}_1, \ldots, \tilde{x}_m\)</span> and not <span class="math inline">\(\overline{f}_h\)</span>
itself.</p>
</div>
<div id="environments" class="section level3" number="10.2.2">
<h3>
<span class="header-section-number">A.2.2</span> Environments<a class="anchor" aria-label="anchor" href="#environments"><i class="fas fa-link"></i></a>
</h3>
<p>Something</p>
<p>Use <code>xs</code> above as example.</p>
</div>
<div id="function-factories" class="section level3" number="10.2.3">
<h3>
<span class="header-section-number">A.2.3</span> Function factories<a class="anchor" aria-label="anchor" href="#function-factories"><i class="fas fa-link"></i></a>
</h3>
<p>Something</p>
<p>The random number streams from Chap. 4. Include implementation in package.</p>
</div>
</div>
<div id="performance" class="section level2" number="10.3">
<h2>
<span class="header-section-number">A.3</span> Performance<a class="anchor" aria-label="anchor" href="#performance"><i class="fas fa-link"></i></a>
</h2>
<p>Something</p>
<p>Mention parallel computations</p>
<div id="tracing" class="section level3" number="10.3.1">
<h3>
<span class="header-section-number">A.3.1</span> Tracing<a class="anchor" aria-label="anchor" href="#tracing"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="rcpp" class="section level3" number="10.3.2">
<h3>
<span class="header-section-number">A.3.2</span> Rcpp<a class="anchor" aria-label="anchor" href="#rcpp"><i class="fas fa-link"></i></a>
</h3>
<p>Use the mean_numeric and mean_complex examples.</p>
</div>
</div>
<div id="objects-and-methods" class="section level2" number="10.4">
<h2>
<span class="header-section-number">A.4</span> Objects and methods<a class="anchor" aria-label="anchor" href="#objects-and-methods"><i class="fas fa-link"></i></a>
</h2>
<p>Something</p>
</div>
<div id="app-ex" class="section level2" number="10.5">
<h2>
<span class="header-section-number">A.5</span> Exercises<a class="anchor" aria-label="anchor" href="#app-ex"><i class="fas fa-link"></i></a>
</h2>
<div id="functions-1" class="section level3 unnumbered">
<h3>Functions<a class="anchor" aria-label="anchor" href="#functions-1"><i class="fas fa-link"></i></a>
</h3>

<div class="exercise">
<span id="exr:numerics" class="exercise"><strong>Exercise A.1  </strong></span>Explain the result of evaluating the following R expression.
</div>
<div class="sourceCode" id="cb511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.3</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>

<div class="exercise">
<p><span id="exr:filter-function" class="exercise"><strong>Exercise A.2  </strong></span>Write a function that takes a numeric vector <code>x</code> and a threshold value <code>h</code>
as arguments and returns the vector of all values in <code>x</code> greater than <code>h</code>.
Test the function on <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 1, 0.1)</a></code> with threshold 0.3. Have the example
from Exercise <a href="app-R.html#exr:numerics">A.1</a> in mind.</p>
</div>

<div class="exercise">
<p><span id="exr:special-values" class="exercise"><strong>Exercise A.3  </strong></span>Investigate how your function from Exercise <a href="app-R.html#exr:filter-function">A.2</a>
treats missing values (<code>NA</code>), infinite values
(<code>Inf</code> and <code>-Inf</code>) and the special value âNot a Numberâ (<code>NaN</code>). Rewrite your
function (if necessary) to exclude all or some of such values from <code>x</code>.</p>
<p><em>Hint: The functions <code>is.na</code>, <code>is.nan</code> and <code>is.finite</code> are useful.</em></p>
</div>
</div>
<div id="histograms-with-non-equidistant-breaks" class="section level3 unnumbered">
<h3>Histograms with non-equidistant breaks<a class="anchor" aria-label="anchor" href="#histograms-with-non-equidistant-breaks"><i class="fas fa-link"></i></a>
</h3>
<p>The following three exercises will use a data set consisting of measurements
of infrared emissions from objects outside of our galax. We will focus on the variable
F12, which is the total 12 micron band flux density.</p>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">infrared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/infrared.txt"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">F12</span> <span class="op">&lt;-</span> <span class="va">infrared</span><span class="op">$</span><span class="va">F12</span></code></pre></div>
<p>The purpose of this exercise is two-fold. First, you will get familiar with the
data and see how different choices of visualizations using histograms can affect
your interpretation of the data. Second, you will learn more about how to write
functions in R and gain a better understanding of how they work.</p>

<div class="exercise">
<p><span id="exr:plotHist" class="exercise"><strong>Exercise A.4  </strong></span>Plot a histogram of <code><a href="https://rdrr.io/r/base/Log.html">log(F12)</a></code> using the default value of the argument <code>breaks</code>. Experiment with alternative values of <code>breaks</code>.</p>
</div>

<div class="exercise">
<p><span id="exr:my-breaks" class="exercise"><strong>Exercise A.5  </strong></span>Write your own function, called <code>my_breaks</code>, which takes two arguments, <code>x</code> (a vector) and <code>h</code> (a positive integer). Let <code>h</code> have default value <code>5</code>. The function should first sort
<code>x</code> into increasing order and then return the vector that: starts with the smallest entry in <code>x</code>;
contains every <span class="math inline">\(h\)</span>th unique entry from the sorted <code>x</code>; ends with the largest entry in <code>x</code>.</p>
<p>For example, if <code>h = 2</code> and <code>x = c(1, 3, 2, 5, 10, 11, 1, 1, 3)</code> the function should return <code><a href="https://rdrr.io/r/base/c.html">c(1, 3, 10, 11)</a></code>. To see this, first sort <code>x</code>, which gives the vector <code><a href="https://rdrr.io/r/base/c.html">c(1, 1, 1, 2, 3, 3, 5, 10, 11)</a></code>, whose unique
values are <code><a href="https://rdrr.io/r/base/c.html">c(1, 2, 3, 5, 10, 11)</a></code>. Every second unique entry is <code><a href="https://rdrr.io/r/base/c.html">c(1, 3, 10)</a></code>, and then the largest entry <code>11</code> is concatenated.</p>
<p><em>Hint: The functions <code>sort</code> and <code>unique</code> can be useful.</em></p>
<p>Use your function to construct <em>breakpoints</em> for the histogram for different values of <code>h</code>, and compare with the histograms obtained in Exercise <a href="app-R.html#exr:plotHist">A.4</a>.</p>
</div>

<div class="exercise">
<p><span id="exr:my-breaks-advanced" class="exercise"><strong>Exercise A.6  </strong></span>If there are no ties in the data set, the function above will produce breakpoints
with <code>h</code> observations in the interval between two consecutive breakpoints
(except the last two perhaps). If there are ties, the function will by construction
return unique breakpoints, but there may be
more than <code>h</code> observations in some intervals.</p>
<p><em>The intention is now to rewrite <code>my_breaks</code> so that if possible each interval
contains <code>h</code> observations.</em></p>
<p>Modify the <code>my_breaks</code> function with this intention and so that is has the
following properties:</p>
<ul>
<li>All breakpoints must be unique.</li>
<li>The range of the breakpoints must cover the range of <code>x</code>.</li>
<li>For two subsequent breakpoints, <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, there must be at least <code>h</code> observations in the interval <span class="math inline">\((a,b],\)</span> provided <code>h &lt; length(x)</code>. (With the exception that for the first two breakpoints, the interval is <span class="math inline">\([a,b].\)</span>)</li>
</ul>
</div>
</div>
<div id="functions-and-objects" class="section level3 unnumbered">
<h3>Functions and objects<a class="anchor" aria-label="anchor" href="#functions-and-objects"><i class="fas fa-link"></i></a>
</h3>
<p>The following exercises build on having implemented a function that
computes breakpoints for a histogram either as in
Exercise <a href="app-R.html#exr:my-breaks">A.5</a> or as in Exercise <a href="app-R.html#exr:my-breaks-advanced">A.6</a>.</p>

<div class="exercise">
<span id="exr:my-hist" class="exercise"><strong>Exercise A.7  </strong></span>Write a function called <code>my_hist</code>, which takes a single argument <code>h</code> and plots a
histogram of <code><a href="https://rdrr.io/r/base/Log.html">log(F12)</a></code>. Extend
the implementation so that any additional argument specified when calling <code>my_hist</code>
is passed on to <code>hist</code>. Investigate and explain what happens when executing
the following function calls.
</div>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">my_hist</span><span class="op">(</span><span class="op">)</span>
<span class="fu">my_hist</span><span class="op">(</span>h <span class="op">=</span> <span class="fl">5</span>, freq <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">my_hist</span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>

<div class="exercise">
<p><span id="exr:my-hist-mod" class="exercise"><strong>Exercise A.8  </strong></span>Modify your <code>my_hist</code> function so that it returns an object of class <code>my_histogram</code>,
which is not plotted. Write a print method for objects of this class,
which prints just the number of cells.</p>
<p><em>Hint: It can be useful to know about the function <code>cat</code>.</em></p>
How can you assign a class label to the returned object so that it is printed using your new print method, but it is still plotted as a histogram when given as argument to <code>plot</code>?
</div>

<div class="exercise">
<span id="exr:my-hist-summary" class="exercise"><strong>Exercise A.9  </strong></span>Write a <code>summary</code> method that returns a data frame with two columns containing the midpoints of the cells and the counts.
</div>

<div class="exercise">
<span id="exr:my-hist-ggplot2" class="exercise"><strong>Exercise A.10  </strong></span>Write a new <code>plot</code> method for objects of class <code>my_histogram</code> that uses <code>ggplot2</code> for plotting the histogram.
</div>
</div>
<div id="functions-and-environments" class="section level3 unnumbered">
<h3>Functions and environments<a class="anchor" aria-label="anchor" href="#functions-and-environments"><i class="fas fa-link"></i></a>
</h3>
<p>The following exercises assume that you have implemented a <code>my_hist</code> function
as in Exercise <a href="app-R.html#exr:my-hist">A.7</a>.</p>

<div class="exercise">
<p><span id="exr:my-hist-env" class="exercise"><strong>Exercise A.11  </strong></span>What happens if you remove that data and call <code>my_hist</code> subsequently?
What is the environment of <code>my_hist</code>? Change it to a new environment, and assign
(using the function <code>assign</code>) the data to a
variable with an appropriate name in that environment. Once this is done,
check what now happens when calling <code>my_hist</code> after
the data is removed from the global environment.</p>
</div>

<div class="exercise">
<p><span id="exr:my-hist-funfact" class="exercise"><strong>Exercise A.12  </strong></span>Write a function that takes an argument <code>x</code> (the data) and
returns a function, where the returned function
takes an argument <code>h</code> (just as <code>my_hist</code>) and plots a histogram (just as <code>my_hist</code>).
Because the return value is a function, we may refer to the function
as a <a href="https://adv-r.hadley.nz/function-factories.html">function factory</a>.</p>
<p>What is the environment of the function created by the function factory? What
is in the environment?
Does it have any effect when calling the function whether the data is altered
or removed from the global environment?</p>
</div>

<div class="exercise">
<p><span id="exr:unnamed-chunk-10" class="exercise"><strong>Exercise A.13  </strong></span>Evaluate the following function call:</p>
</div>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">my_hist</span><span class="op">(</span><span class="fl">10</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>What is the type and class of <code>tmp</code>? What happens when <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(tmp, col = "red")</a></code>
is executed? How can you find help on what <code>plot</code> does with an
object of this class? Specifically, how do you find the documentation for the
argument <code>col</code>, which is not an argument of <code>plot</code>?</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="StochOpt.html"><span class="header-section-number">9</span> Stochastic Optimization</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#app-R"><span class="header-section-number">A</span> R programming</a></li>
<li>
<a class="nav-link" href="#app-data-structures"><span class="header-section-number">A.1</span> Data structures</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#atomic-vectors"><span class="header-section-number">A.1.1</span> Atomic vectors</a></li>
<li><a class="nav-link" href="#comparisons-and-numerical-precision"><span class="header-section-number">A.1.2</span> Comparisons and numerical precision</a></li>
<li><a class="nav-link" href="#lists"><span class="header-section-number">A.1.3</span> Lists</a></li>
<li><a class="nav-link" href="#other-data-structures"><span class="header-section-number">A.1.4</span> Other data structures</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#functions"><span class="header-section-number">A.2</span> Functions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vectorization"><span class="header-section-number">A.2.1</span> Vectorization</a></li>
<li><a class="nav-link" href="#environments"><span class="header-section-number">A.2.2</span> Environments</a></li>
<li><a class="nav-link" href="#function-factories"><span class="header-section-number">A.2.3</span> Function factories</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#performance"><span class="header-section-number">A.3</span> Performance</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tracing"><span class="header-section-number">A.3.1</span> Tracing</a></li>
<li><a class="nav-link" href="#rcpp"><span class="header-section-number">A.3.2</span> Rcpp</a></li>
</ul>
</li>
<li><a class="nav-link" href="#objects-and-methods"><span class="header-section-number">A.4</span> Objects and methods</a></li>
<li>
<a class="nav-link" href="#app-ex"><span class="header-section-number">A.5</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#functions-1">Functions</a></li>
<li><a class="nav-link" href="#histograms-with-non-equidistant-breaks">Histograms with non-equidistant breaks</a></li>
<li><a class="nav-link" href="#functions-and-objects">Functions and objects</a></li>
<li><a class="nav-link" href="#functions-and-environments">Functions and environments</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/nielsrhansen/CSwR/blob/master/32-R.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/nielsrhansen/CSwR/edit/master/32-R.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Computational Statistics with R</strong>" was written by Niels Richard Hansen. It was last built on 2021-10-12, Git version: 6b05821.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
