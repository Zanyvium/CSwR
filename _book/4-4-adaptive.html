<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.4 Adaptive envelopes | Computational Statistics with R</title>
  <meta name="description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4.4 Adaptive envelopes | Computational Statistics with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.4 Adaptive envelopes | Computational Statistics with R" />
  
  <meta name="twitter:description" content="Lecture notes providing an introduction to computational statistics using the R programming language." />
  

<meta name="author" content="Niels Richard Hansen" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="4-3-reject-samp.html"/>
<link rel="next" href="4-5-univariate-ex.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-intro.html"><a href="1-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html"><i class="fa fa-check"></i><b>1.1</b> Smoothing</a><ul>
<li class="chapter" data-level="1.1.1" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#intro-angles"><i class="fa fa-check"></i><b>1.1.1</b> Angle distributions in proteins</a></li>
<li class="chapter" data-level="1.1.2" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#using-ggplot2"><i class="fa fa-check"></i><b>1.1.2</b> Using ggplot2</a></li>
<li class="chapter" data-level="1.1.3" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#changing-the-defaults"><i class="fa fa-check"></i><b>1.1.3</b> Changing the defaults</a></li>
<li class="chapter" data-level="1.1.4" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#multivariate-smoothing"><i class="fa fa-check"></i><b>1.1.4</b> Multivariate methods</a></li>
<li class="chapter" data-level="1.1.5" data-path="1-1-intro-smooth.html"><a href="1-1-intro-smooth.html#large-scale-smoothing"><i class="fa fa-check"></i><b>1.1.5</b> Large scale smoothing</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html"><i class="fa fa-check"></i><b>1.2</b> Monte Carlo methods</a><ul>
<li class="chapter" data-level="1.2.1" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html#vM"><i class="fa fa-check"></i><b>1.2.1</b> Univariate von Mises distributions</a></li>
<li class="chapter" data-level="1.2.2" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html#mixtures-of-von-mises-distributions"><i class="fa fa-check"></i><b>1.2.2</b> Mixtures of von Mises distributions</a></li>
<li class="chapter" data-level="1.2.3" data-path="1-2-monte-carlo-methods.html"><a href="1-2-monte-carlo-methods.html#large-scale-monte-carlo-methods"><i class="fa fa-check"></i><b>1.2.3</b> Large scale Monte Carlo methods</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="1-3-optimization.html"><a href="1-3-optimization.html"><i class="fa fa-check"></i><b>1.3</b> Optimization</a><ul>
<li class="chapter" data-level="1.3.1" data-path="1-3-optimization.html"><a href="1-3-optimization.html#the-em-algorithm"><i class="fa fa-check"></i><b>1.3.1</b> The EM-algorithm</a></li>
<li class="chapter" data-level="1.3.2" data-path="1-3-optimization.html"><a href="1-3-optimization.html#large-scale-optimization"><i class="fa fa-check"></i><b>1.3.2</b> Large scale optimization</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part I: Smoothing</b></span></li>
<li class="chapter" data-level="2" data-path="2-density.html"><a href="2-density.html"><i class="fa fa-check"></i><b>2</b> Density estimation</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-unidens.html"><a href="2-1-unidens.html"><i class="fa fa-check"></i><b>2.1</b> Univariate density estimation</a></li>
<li class="chapter" data-level="2.2" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html"><i class="fa fa-check"></i><b>2.2</b> Kernel methods</a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html#implementation"><i class="fa fa-check"></i><b>2.2.1</b> Implementation</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html#benchmarking"><i class="fa fa-check"></i><b>2.2.2</b> Benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html"><i class="fa fa-check"></i><b>2.3</b> Bandwidth selection</a><ul>
<li class="chapter" data-level="2.3.1" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#rectangular"><i class="fa fa-check"></i><b>2.3.1</b> Revisiting the rectangular kernel</a></li>
<li class="chapter" data-level="2.3.2" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#ise-mise-and-mse-for-kernel-estimators"><i class="fa fa-check"></i><b>2.3.2</b> ISE, MISE and MSE for kernel estimators</a></li>
<li class="chapter" data-level="2.3.3" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#plug-in-estimation-of-the-oracle-bandwidth"><i class="fa fa-check"></i><b>2.3.3</b> Plug-in estimation of the oracle bandwidth</a></li>
<li class="chapter" data-level="2.3.4" data-path="2-3-bandwidth.html"><a href="2-3-bandwidth.html#cv"><i class="fa fa-check"></i><b>2.3.4</b> Cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="2-4-likelihood.html"><a href="2-4-likelihood.html"><i class="fa fa-check"></i><b>2.4</b> Likelihood considerations</a><ul>
<li class="chapter" data-level="2.4.1" data-path="2-4-likelihood.html"><a href="2-4-likelihood.html#sieves"><i class="fa fa-check"></i><b>2.4.1</b> Method of sieves</a></li>
<li class="chapter" data-level="2.4.2" data-path="2-4-likelihood.html"><a href="2-4-likelihood.html#basis-density"><i class="fa fa-check"></i><b>2.4.2</b> Basis expansions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="2-5-density-ex.html"><a href="2-5-density-ex.html"><i class="fa fa-check"></i><b>2.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="2-5-density-ex.html"><a href="2-5-density-ex.html#kernel-density-estimation"><i class="fa fa-check"></i>Kernel density estimation</a></li>
<li class="chapter" data-level="" data-path="2-5-density-ex.html"><a href="2-5-density-ex.html#benchmarking-1"><i class="fa fa-check"></i>Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-bivariate.html"><a href="3-bivariate.html"><i class="fa fa-check"></i><b>3</b> Bivariate smoothing</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html"><i class="fa fa-check"></i><b>3.1</b> Nearest neighbor smoothers</a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html#linear-smoothers"><i class="fa fa-check"></i><b>3.1.1</b> Linear smoothers</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html#implementing-the-running-mean"><i class="fa fa-check"></i><b>3.1.2</b> Implementing the running mean</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-nearest-neighbor-smoothers.html"><a href="3-1-nearest-neighbor-smoothers.html#choose-k-by-cross-validation"><i class="fa fa-check"></i><b>3.1.3</b> Choose <span class="math inline">\(k\)</span> by cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-2-kernel-methods.html"><a href="3-2-kernel-methods.html"><i class="fa fa-check"></i><b>3.2</b> Kernel methods</a><ul>
<li class="chapter" data-level="3.2.1" data-path="3-2-kernel-methods.html"><a href="3-2-kernel-methods.html#nadarayawatson-kernel-smoothing"><i class="fa fa-check"></i><b>3.2.1</b> Nadaraya–Watson kernel smoothing</a></li>
<li class="chapter" data-level="3.2.2" data-path="3-2-kernel-methods.html"><a href="3-2-kernel-methods.html#local-regression-smoothers"><i class="fa fa-check"></i><b>3.2.2</b> Local regression smoothers</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-3-sparse-linear-algebra.html"><a href="3-3-sparse-linear-algebra.html"><i class="fa fa-check"></i><b>3.3</b> Sparse linear algebra</a></li>
<li class="chapter" data-level="3.4" data-path="3-4-onb.html"><a href="3-4-onb.html"><i class="fa fa-check"></i><b>3.4</b> Orthogonal basis expansions</a><ul>
<li class="chapter" data-level="3.4.1" data-path="3-4-onb.html"><a href="3-4-onb.html#polynomial-expansions"><i class="fa fa-check"></i><b>3.4.1</b> Polynomial expansions</a></li>
<li class="chapter" data-level="3.4.2" data-path="3-4-onb.html"><a href="3-4-onb.html#fourier-expansions"><i class="fa fa-check"></i><b>3.4.2</b> Fourier expansions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="3-5-splines.html"><a href="3-5-splines.html"><i class="fa fa-check"></i><b>3.5</b> Splines</a><ul>
<li class="chapter" data-level="3.5.1" data-path="3-5-splines.html"><a href="3-5-splines.html#smoothing-splines"><i class="fa fa-check"></i><b>3.5.1</b> Smoothing splines</a></li>
<li class="chapter" data-level="3.5.2" data-path="3-5-splines.html"><a href="3-5-splines.html#splines-in-r"><i class="fa fa-check"></i><b>3.5.2</b> Splines in R</a></li>
<li class="chapter" data-level="3.5.3" data-path="3-5-splines.html"><a href="3-5-splines.html#efficient-splines"><i class="fa fa-check"></i><b>3.5.3</b> Efficient computation with splines</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="3-6-gaussian-processes.html"><a href="3-6-gaussian-processes.html"><i class="fa fa-check"></i><b>3.6</b> Gaussian processes</a></li>
<li class="chapter" data-level="3.7" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html"><i class="fa fa-check"></i><b>3.7</b> The Kalman filter</a><ul>
<li class="chapter" data-level="3.7.1" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html#ar1-example"><i class="fa fa-check"></i><b>3.7.1</b> AR(1)-example</a></li>
<li class="chapter" data-level="3.7.2" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html#the-kalman-smoother"><i class="fa fa-check"></i><b>3.7.2</b> The Kalman smoother</a></li>
<li class="chapter" data-level="3.7.3" data-path="2-2-kernel-density.html"><a href="2-2-kernel-density.html#implementation"><i class="fa fa-check"></i><b>3.7.3</b> Implementation</a></li>
<li class="chapter" data-level="3.7.4" data-path="3-7-the-kalman-filter.html"><a href="3-7-the-kalman-filter.html#the-kalman-filter-1"><i class="fa fa-check"></i><b>3.7.4</b> The Kalman filter</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="3-8-bivariate-ex.html"><a href="3-8-bivariate-ex.html"><i class="fa fa-check"></i><b>3.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="3-8-bivariate-ex.html"><a href="3-8-bivariate-ex.html#nearest-neighbors"><i class="fa fa-check"></i>Nearest neighbors</a></li>
<li class="chapter" data-level="" data-path="3-8-bivariate-ex.html"><a href="3-8-bivariate-ex.html#kernel-estimators"><i class="fa fa-check"></i>Kernel estimators</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part II: Monte Carlo Methods</b></span></li>
<li class="chapter" data-level="4" data-path="4-univariate-random-variables.html"><a href="4-univariate-random-variables.html"><i class="fa fa-check"></i><b>4</b> Univariate random variables</a><ul>
<li class="chapter" data-level="4.1" data-path="4-1-pseudorandom-number-generators.html"><a href="4-1-pseudorandom-number-generators.html"><i class="fa fa-check"></i><b>4.1</b> Pseudorandom number generators</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-1-pseudorandom-number-generators.html"><a href="4-1-pseudorandom-number-generators.html#implementing-a-pseudorandom-number-generator"><i class="fa fa-check"></i><b>4.1.1</b> Implementing a pseudorandom number generator</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-1-pseudorandom-number-generators.html"><a href="4-1-pseudorandom-number-generators.html#pseudorandom-number-packages"><i class="fa fa-check"></i><b>4.1.2</b> Pseudorandom number packages</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-2-transformation-techniques.html"><a href="4-2-transformation-techniques.html"><i class="fa fa-check"></i><b>4.2</b> Transformation techniques</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-2-transformation-techniques.html"><a href="4-2-transformation-techniques.html#sampling-from-a-t-distribution"><i class="fa fa-check"></i><b>4.2.1</b> Sampling from a <span class="math inline">\(t\)</span>-distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-3-reject-samp.html"><a href="4-3-reject-samp.html"><i class="fa fa-check"></i><b>4.3</b> Rejection sampling</a><ul>
<li class="chapter" data-level="4.3.1" data-path="4-3-reject-samp.html"><a href="4-3-reject-samp.html#vMsim"><i class="fa fa-check"></i><b>4.3.1</b> von Mises distribution</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-3-reject-samp.html"><a href="4-3-reject-samp.html#gamma-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Gamma distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-4-adaptive.html"><a href="4-4-adaptive.html"><i class="fa fa-check"></i><b>4.4</b> Adaptive envelopes</a><ul>
<li class="chapter" data-level="4.4.1" data-path="4-4-adaptive.html"><a href="4-4-adaptive.html#beta-distribution"><i class="fa fa-check"></i><b>4.4.1</b> Beta distribution</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-4-adaptive.html"><a href="4-4-adaptive.html#von-mises-distribution"><i class="fa fa-check"></i><b>4.4.2</b> von Mises distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="4-5-univariate-ex.html"><a href="4-5-univariate-ex.html"><i class="fa fa-check"></i><b>4.5</b> Exercises</a><ul>
<li class="chapter" data-level="4.5.1" data-path="4-5-univariate-ex.html"><a href="4-5-univariate-ex.html#rejection-sampling-of-gaussian-random-variables"><i class="fa fa-check"></i><b>4.5.1</b> Rejection sampling of Gaussian random variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-mci.html"><a href="5-mci.html"><i class="fa fa-check"></i><b>5</b> Monte Carlo integration</a><ul>
<li class="chapter" data-level="5.1" data-path="5-1-assessment.html"><a href="5-1-assessment.html"><i class="fa fa-check"></i><b>5.1</b> Assessment</a><ul>
<li class="chapter" data-level="5.1.1" data-path="5-1-assessment.html"><a href="5-1-assessment.html#CLT-gamma"><i class="fa fa-check"></i><b>5.1.1</b> Using the central limit theorem</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-1-assessment.html"><a href="5-1-assessment.html#concentration-inequalities"><i class="fa fa-check"></i><b>5.1.2</b> Concentration inequalities</a></li>
<li class="chapter" data-level="5.1.3" data-path="5-1-assessment.html"><a href="5-1-assessment.html#exponential-tail-bound-for-gamma-distributed-variables"><i class="fa fa-check"></i><b>5.1.3</b> Exponential tail bound for Gamma distributed variables</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-2-importance-sampling.html"><a href="5-2-importance-sampling.html"><i class="fa fa-check"></i><b>5.2</b> Importance sampling</a><ul>
<li class="chapter" data-level="5.2.1" data-path="5-2-importance-sampling.html"><a href="5-2-importance-sampling.html#unknown-normalization-constants"><i class="fa fa-check"></i><b>5.2.1</b> Unknown normalization constants</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-2-importance-sampling.html"><a href="5-2-importance-sampling.html#hd-int"><i class="fa fa-check"></i><b>5.2.2</b> Computing a high-dimensional integral</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-3-network.html"><a href="5-3-network.html"><i class="fa fa-check"></i><b>5.3</b> Network failure</a><ul>
<li class="chapter" data-level="5.3.1" data-path="5-3-network.html"><a href="5-3-network.html#object-oriented-implementations"><i class="fa fa-check"></i><b>5.3.1</b> Object oriented implementations</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Part III: Optimization</b></span></li>
<li class="chapter" data-level="6" data-path="6-four-examples.html"><a href="6-four-examples.html"><i class="fa fa-check"></i><b>6</b> Four Examples</a><ul>
<li class="chapter" data-level="6.1" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html"><i class="fa fa-check"></i><b>6.1</b> Exponential families</a><ul>
<li class="chapter" data-level="6.1.1" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#full-exponential-families"><i class="fa fa-check"></i><b>6.1.1</b> Full exponential families</a></li>
<li class="chapter" data-level="6.1.2" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#bayes-net"><i class="fa fa-check"></i><b>6.1.2</b> Exponential family Bayesian networks</a></li>
<li class="chapter" data-level="6.1.3" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#exp-fam-deriv"><i class="fa fa-check"></i><b>6.1.3</b> Likelihood computations</a></li>
<li class="chapter" data-level="6.1.4" data-path="6-1-exp-fam.html"><a href="6-1-exp-fam.html#curved-exponential-families"><i class="fa fa-check"></i><b>6.1.4</b> Curved exponential families</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-2-multinomial-models.html"><a href="6-2-multinomial-models.html"><i class="fa fa-check"></i><b>6.2</b> Multinomial models</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-2-multinomial-models.html"><a href="6-2-multinomial-models.html#pep-moth"><i class="fa fa-check"></i><b>6.2.1</b> Peppered Moths</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-3-regression.html"><a href="6-3-regression.html"><i class="fa fa-check"></i><b>6.3</b> Regression models</a></li>
<li class="chapter" data-level="6.4" data-path="6-4-finite-mixture-models.html"><a href="6-4-finite-mixture-models.html"><i class="fa fa-check"></i><b>6.4</b> Finite mixture models</a><ul>
<li class="chapter" data-level="6.4.1" data-path="6-4-finite-mixture-models.html"><a href="6-4-finite-mixture-models.html#Gaus-mix-ex"><i class="fa fa-check"></i><b>6.4.1</b> Gaussian mixtures</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="6-5-mixed-models.html"><a href="6-5-mixed-models.html"><i class="fa fa-check"></i><b>6.5</b> Mixed models</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-numopt.html"><a href="7-numopt.html"><i class="fa fa-check"></i><b>7</b> Numerical optimization</a><ul>
<li class="chapter" data-level="7.1" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html"><i class="fa fa-check"></i><b>7.1</b> Algorithms and convergence</a><ul>
<li class="chapter" data-level="7.1.1" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#descent-algorithms"><i class="fa fa-check"></i><b>7.1.1</b> Descent algorithms</a></li>
<li class="chapter" data-level="7.1.2" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#maps-and-fixed-points"><i class="fa fa-check"></i><b>7.1.2</b> Maps and fixed points</a></li>
<li class="chapter" data-level="7.1.3" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#convergence-rate"><i class="fa fa-check"></i><b>7.1.3</b> Convergence rate</a></li>
<li class="chapter" data-level="7.1.4" data-path="7-1-algorithms-and-convergence.html"><a href="7-1-algorithms-and-convergence.html#stopping-criteria"><i class="fa fa-check"></i><b>7.1.4</b> Stopping criteria</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html"><i class="fa fa-check"></i><b>7.2</b> Descent direction algorithms</a><ul>
<li class="chapter" data-level="7.2.1" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#line-search"><i class="fa fa-check"></i><b>7.2.1</b> Line search</a></li>
<li class="chapter" data-level="7.2.2" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#gradient-descent"><i class="fa fa-check"></i><b>7.2.2</b> Gradient descent</a></li>
<li class="chapter" data-level="7.2.3" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#conjugate-gradients"><i class="fa fa-check"></i><b>7.2.3</b> Conjugate gradients</a></li>
<li class="chapter" data-level="7.2.4" data-path="7-2-descent-direction-algorithms.html"><a href="7-2-descent-direction-algorithms.html#pep-moth-descent"><i class="fa fa-check"></i><b>7.2.4</b> Peppered Moths</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html"><i class="fa fa-check"></i><b>7.3</b> Newton-type algorithms</a><ul>
<li class="chapter" data-level="7.3.1" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html#poisson-regression"><i class="fa fa-check"></i><b>7.3.1</b> Poisson regression</a></li>
<li class="chapter" data-level="7.3.2" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html#quasi-newton-algorithms"><i class="fa fa-check"></i><b>7.3.2</b> Quasi-Newton algorithms</a></li>
<li class="chapter" data-level="7.3.3" data-path="7-3-newton-type-algorithms.html"><a href="7-3-newton-type-algorithms.html#sparsity"><i class="fa fa-check"></i><b>7.3.3</b> Sparsity</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="7-4-misc-.html"><a href="7-4-misc-.html"><i class="fa fa-check"></i><b>7.4</b> Misc.</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-em.html"><a href="8-em.html"><i class="fa fa-check"></i><b>8</b> Expectation maximization algorithms</a><ul>
<li class="chapter" data-level="8.1" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html"><i class="fa fa-check"></i><b>8.1</b> Basic properties</a><ul>
<li class="chapter" data-level="8.1.1" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html#incomplete-data-likelihood"><i class="fa fa-check"></i><b>8.1.1</b> Incomplete data likelihood</a></li>
<li class="chapter" data-level="8.1.2" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html#monotonicity-of-the-em-algorithm"><i class="fa fa-check"></i><b>8.1.2</b> Monotonicity of the EM algorithm</a></li>
<li class="chapter" data-level="8.1.3" data-path="8-1-basic-properties.html"><a href="8-1-basic-properties.html#peppered-moths"><i class="fa fa-check"></i><b>8.1.3</b> Peppered moths</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-2-EM-exp.html"><a href="8-2-EM-exp.html"><i class="fa fa-check"></i><b>8.2</b> Exponential families</a></li>
<li class="chapter" data-level="8.3" data-path="8-3-fisher-information.html"><a href="8-3-fisher-information.html"><i class="fa fa-check"></i><b>8.3</b> Fisher information</a></li>
<li class="chapter" data-level="8.4" data-path="8-4-revisiting-gaussian-mixtures.html"><a href="8-4-revisiting-gaussian-mixtures.html"><i class="fa fa-check"></i><b>8.4</b> Revisiting Gaussian mixtures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-StochOpt.html"><a href="9-StochOpt.html"><i class="fa fa-check"></i><b>9</b> Stochastic Optimization</a><ul>
<li class="chapter" data-level="9.1" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html"><i class="fa fa-check"></i><b>9.1</b> Stochastic gradient algorithms</a><ul>
<li class="chapter" data-level="9.1.1" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html#section"><i class="fa fa-check"></i><b>9.1.1</b> </a></li>
<li class="chapter" data-level="9.1.2" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html#online-stochastic-gradient-descent"><i class="fa fa-check"></i><b>9.1.2</b> Online stochastic gradient descent</a></li>
<li class="chapter" data-level="9.1.3" data-path="9-1-stochastic-gradient-algorithms.html"><a href="9-1-stochastic-gradient-algorithms.html#stochastic-gradient-descent"><i class="fa fa-check"></i><b>9.1.3</b> Stochastic gradient descent</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="9-2-nonlinear-least-squares.html"><a href="9-2-nonlinear-least-squares.html"><i class="fa fa-check"></i><b>9.2</b> Nonlinear least squares</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="A-app-R.html"><a href="A-app-R.html"><i class="fa fa-check"></i><b>A</b> R programming</a><ul>
<li class="chapter" data-level="A.1" data-path="A-1-functions.html"><a href="A-1-functions.html"><i class="fa fa-check"></i><b>A.1</b> Functions</a><ul>
<li class="chapter" data-level="A.1.1" data-path="A-1-functions.html"><a href="A-1-functions.html#vectorization"><i class="fa fa-check"></i><b>A.1.1</b> Vectorization</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="A-2-objects-and-methods.html"><a href="A-2-objects-and-methods.html"><i class="fa fa-check"></i><b>A.2</b> Objects and methods</a></li>
<li class="chapter" data-level="A.3" data-path="A-3-environments.html"><a href="A-3-environments.html"><i class="fa fa-check"></i><b>A.3</b> Environments</a><ul>
<li class="chapter" data-level="A.3.1" data-path="A-3-environments.html"><a href="A-3-environments.html#function-factories"><i class="fa fa-check"></i><b>A.3.1</b> Function factories</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="A-4-performance.html"><a href="A-4-performance.html"><i class="fa fa-check"></i><b>A.4</b> Performance</a><ul>
<li class="chapter" data-level="A.4.1" data-path="A-4-performance.html"><a href="A-4-performance.html#parallel-computations"><i class="fa fa-check"></i><b>A.4.1</b> Parallel computations</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html"><i class="fa fa-check"></i><b>A.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#histograms-with-non-equidistant-breaks"><i class="fa fa-check"></i>Histograms with non-equidistant breaks</a></li>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#functions-and-objects"><i class="fa fa-check"></i>Functions and objects</a></li>
<li class="chapter" data-level="" data-path="A-5-app-ex.html"><a href="A-5-app-ex.html#functions-and-environments"><i class="fa fa-check"></i>Functions and environments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Statistics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="adaptive" class="section level2">
<h2><span class="header-section-number">4.4</span> Adaptive envelopes</h2>
<p>A good envelope should be tight, meaning that <span class="math inline">\(\alpha\)</span> is close to one,
it should be fast to simulate from and have a density that is
fast to evaluate. It is not obvious how to find such an envelope
for an arbitrary target density <span class="math inline">\(f\)</span>.</p>
<p>This section develops a general scheme for the construction of envelopes
for all <a href="https://en.wikipedia.org/wiki/Logarithmically_concave_function#Log-concave_distributions">log-concave target densities</a>. This is a special class of densities,
but it is not uncommon in practice. The scheme can also be extended to work
for some densities that have combinations of log-concave and log-convex
behaviors. The same idea used for constructing
envelopes can be used to bound <span class="math inline">\(f\)</span> from below. The accept-reject step
can then avoid many evaluations of <span class="math inline">\(f\)</span>, which is beneficial if <span class="math inline">\(f\)</span> is
computationally expensive to evaluate.</p>
<p>The key idea of the scheme is to bound the log-density by piecewise
affine functions. This is particularly easy to do if the density
is log-concave. The scheme leads to analytically manageable
formulas for the envelope, its corresponding distribution function and its
inverse, and as a result it is fast to simulate proposals and
compute the envelope as needed in the accept-reject step.</p>
<p>The scheme requires the choice of a finite number of points to determine
the affine bounds. For any given choice of points the scheme adapts the
envelope to the target density automatically. It is possible to implement
a <em>fully</em> adaptive scheme that doesn’t even require the choice of points
but initializes and updates the points dynamically as more and more rejection
samples are computed. In this section the focus is on the scheme with
a given and fixed number of points.</p>
<p>For a continuously differentiable, strictly positive and
log-concave target on an open interval <span class="math inline">\(I \subseteq \mathbb{R}\)</span>
it holds that
<span class="math display">\[\log(f(x)) \leq \frac{f&#39;(x_0)}{f(x_0)}(x - x_0) + \log(f(x_0))\]</span>
for any <span class="math inline">\(x, x_0 \in I\)</span>.</p>
<p>Let <span class="math inline">\(x_1 &lt; x_2 &lt; \ldots &lt; x_{m} \in I\)</span> and let <span class="math inline">\(I_1, \ldots, I_m \subseteq I\)</span> be
intervals that form a partition of <span class="math inline">\(I\)</span> such that <span class="math inline">\(x_i \in I_i\)</span>. Defining
<span class="math display">\[a_i = (\log(f(x_i)))&#39; = \frac{f&#39;(x_i)}{f(x_i)} \quad \text{and} \quad b_i = \log(f(x_i)) -  \alpha_i x_i\]</span>
we find the upper bound
<span class="math display">\[\log(f(x)) \leq V(x) = \sum_{i=1}^m  (a_i x + b_i) 1_{I_i}(x),\]</span>
or
<span class="math display">\[f(x) \leq e^{V(x)}.\]</span>
Note that by the log-concavity of <span class="math inline">\(f\)</span>, <span class="math inline">\(a_1 \geq a_2 \geq \ldots \geq a_m\)</span>.
The upper bound is integrable over <span class="math inline">\(I\)</span> if either <span class="math inline">\(a_1 &gt; 0\)</span> and <span class="math inline">\(a_m &lt; 0\)</span>,
or <span class="math inline">\(a_m &lt; 0\)</span> and <span class="math inline">\(I\)</span> is bounded to the left, or <span class="math inline">\(a_1 &gt; 0\)</span> and <span class="math inline">\(I\)</span> is bounded
to the right. In any of these cases we define
<span class="math display">\[c = \int_I e^{V(x)} \mathrm{d} x &lt; \infty\]</span>
and <span class="math inline">\(g(x) = c^{-1} \exp(V(x))\)</span>, and we find that with <span class="math inline">\(\alpha = c^{-1}\)</span>
then <span class="math inline">\(\alpha f \leq g\)</span> and <span class="math inline">\(g\)</span> is an envelope of <span class="math inline">\(f\)</span>. Note that it is
actually not necessary to compute <span class="math inline">\(c\)</span> (or <span class="math inline">\(\alpha\)</span>) to implement the
rejection step in the rejection sampler, but that <span class="math inline">\(c\)</span> is needed for
simulating from <span class="math inline">\(g\)</span> as described below. We will assume in the following
that <span class="math inline">\(c &lt; \infty\)</span>.</p>
<p>The intervals <span class="math inline">\(I_i\)</span> have not been specified, and we could, in fact, implement
rejection sampling with any choice of intervals fulfilling the conditions
above. But in the interest of maximizing
<span class="math inline">\(\alpha\)</span> (minimizing <span class="math inline">\(c\)</span>) and thus minimizing the rejection frequency, we
should choose <span class="math inline">\(I_i\)</span> so that <span class="math inline">\(a_i x + b_i\)</span> is minimal over <span class="math inline">\(I_i\)</span> among all the affine
upper bounds. This will result in the tightest envelope. This means
that for <span class="math inline">\(i = 1, \ldots, m - 1\)</span>, <span class="math inline">\(I_i = (z_{i-1}, z_i]\)</span> with <span class="math inline">\(z_i\)</span>
the point where <span class="math inline">\(a_i x + b_i\)</span> and <span class="math inline">\(a_{i+1} x + b_{i+1}\)</span> intersect. We find
that the solution of
<span class="math display">\[a_i x + b_i = a_{i+1} x + b_{i+1}\]</span>
is
<span class="math display">\[z_i = \frac{b_{i+1} - b_i}{a_i - a_{i+1}}\]</span>
provided that <span class="math inline">\(a_{i+1} &gt; a_i\)</span>. The two extremes, <span class="math inline">\(z_0\)</span> and <span class="math inline">\(z_m\)</span>, are chosen
as the endpoints of <span class="math inline">\(I\)</span> and may be <span class="math inline">\(- \infty\)</span> and <span class="math inline">\(+ \infty\)</span>, respectively.</p>
<p>One way to simulate from such envelopes is by transformation
of uniform random variables by the inverse distribution function.
It requires a little bookkeeping, but is otherwise straightforward.
Define for <span class="math inline">\(x \in I_i\)</span>
<span class="math display">\[F_i(x) = \int_{z_{i-1}}^x e^{a_i z + b_i} \mathrm{d} z,\]</span>
and let <span class="math inline">\(R_i = F_i(z_i)\)</span>. Then <span class="math inline">\(c = \sum_{i=1}^m R_i\)</span>, and
if we define <span class="math inline">\(Q_i = \sum_{k=1}^{i} R_k\)</span> for <span class="math inline">\(i = 0, \ldots, m\)</span>
the inverse of the distribution function in <span class="math inline">\(q\)</span> is given as the solution to
the equation
<span class="math display">\[F_i(x) = cq - Q_{i-1}, \qquad Q_{i-1} &lt; cq \leq Q_{i}.\]</span>
That is, for a given <span class="math inline">\(q \in (0, 1)\)</span>, first determine which interval
<span class="math inline">\((Q_{i-1}, Q_{i}]\)</span> that <span class="math inline">\(c q\)</span> falls into, and then solve the corresponding
equation. Observe that when <span class="math inline">\(a_i \neq 0\)</span>,
<span class="math display">\[F_i(x) = \frac{1}{a_i}e^{b_i}\left(e^{a_i x} - e^{a_i z_{i-1}}\right).\]</span></p>
<div id="beta-distribution" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Beta distribution</h3>
<p>To illustrate the envelope construction above for a simple log-concave
density we consider the Beta distribution on <span class="math inline">\((0, 1)\)</span> with shape parameters <span class="math inline">\(\geq 1\)</span>.
This distribution has density
<span class="math display">\[f(x) \propto x^{\alpha - 1}(1-x)^{\beta - 1},\]</span>
which is log-concave (when the shape parameters are greater than one).
We implement the rejection sampling algorithm for this density with the adaptive
envelope using two points.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="4-4-adaptive.html#cb185-1"></a>Betasim &lt;-<span class="st"> </span><span class="cf">function</span>(n, x1, x2, alpha, beta) {</span>
<span id="cb185-2"><a href="4-4-adaptive.html#cb185-2"></a>  lf &lt;-<span class="st"> </span><span class="cf">function</span>(x) (alpha <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(x) <span class="op">+</span><span class="st"> </span>(beta <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x) </span>
<span id="cb185-3"><a href="4-4-adaptive.html#cb185-3"></a>  lf_deriv &lt;-<span class="st"> </span><span class="cf">function</span>(x) (alpha <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>x <span class="op">-</span><span class="st"> </span>(beta <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x)</span>
<span id="cb185-4"><a href="4-4-adaptive.html#cb185-4"></a>  a1 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x1)</span>
<span id="cb185-5"><a href="4-4-adaptive.html#cb185-5"></a>  a2 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x2)</span>
<span id="cb185-6"><a href="4-4-adaptive.html#cb185-6"></a>  <span class="cf">if</span>(a1 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>a2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>a1 <span class="op">-</span><span class="st"> </span>a2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) </span>
<span id="cb185-7"><a href="4-4-adaptive.html#cb185-7"></a>    <span class="kw">stop</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">The implementation requires a_1 and a_2 different </span></span>
<span id="cb185-8"><a href="4-4-adaptive.html#cb185-8"></a><span class="st">and both different from zero. Choose different values of x_1 and x_2.&quot;</span>)</span>
<span id="cb185-9"><a href="4-4-adaptive.html#cb185-9"></a>  b1 &lt;-<span class="st"> </span><span class="kw">lf</span>(x1) <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>x1</span>
<span id="cb185-10"><a href="4-4-adaptive.html#cb185-10"></a>  b2 &lt;-<span class="st"> </span><span class="kw">lf</span>(x2) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>x2</span>
<span id="cb185-11"><a href="4-4-adaptive.html#cb185-11"></a>  z1 &lt;-<span class="st"> </span>(b2 <span class="op">-</span><span class="st"> </span>b1) <span class="op">/</span><span class="st"> </span>(a1 <span class="op">-</span><span class="st"> </span>a2)</span>
<span id="cb185-12"><a href="4-4-adaptive.html#cb185-12"></a>  Q1 &lt;-<span class="st"> </span><span class="kw">exp</span>(b1) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z1) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>a1 </span>
<span id="cb185-13"><a href="4-4-adaptive.html#cb185-13"></a>  c &lt;-<span class="st"> </span>Q1 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b2) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span><span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2</span>
<span id="cb185-14"><a href="4-4-adaptive.html#cb185-14"></a></span>
<span id="cb185-15"><a href="4-4-adaptive.html#cb185-15"></a>  y &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</span>
<span id="cb185-16"><a href="4-4-adaptive.html#cb185-16"></a>  uy &lt;-<span class="st"> </span><span class="kw">rng_stream</span>(n, runif)</span>
<span id="cb185-17"><a href="4-4-adaptive.html#cb185-17"></a>  u &lt;-<span class="st"> </span><span class="kw">rng_stream</span>(n, runif)</span>
<span id="cb185-18"><a href="4-4-adaptive.html#cb185-18"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb185-19"><a href="4-4-adaptive.html#cb185-19"></a>    reject &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb185-20"><a href="4-4-adaptive.html#cb185-20"></a>    <span class="cf">while</span>(reject) {</span>
<span id="cb185-21"><a href="4-4-adaptive.html#cb185-21"></a>      u0 &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">uy</span>(n <span class="op">-</span><span class="st"> </span>i)</span>
<span id="cb185-22"><a href="4-4-adaptive.html#cb185-22"></a>      <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q1) {</span>
<span id="cb185-23"><a href="4-4-adaptive.html#cb185-23"></a>        z &lt;-<span class="st"> </span><span class="kw">log</span>(a1 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b1) <span class="op">*</span><span class="st"> </span>u0 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>a1</span>
<span id="cb185-24"><a href="4-4-adaptive.html#cb185-24"></a>        reject &lt;-<span class="st"> </span><span class="kw">u</span>(n <span class="op">-</span><span class="st"> </span>i) <span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b1)</span>
<span id="cb185-25"><a href="4-4-adaptive.html#cb185-25"></a>      } <span class="cf">else</span> {</span>
<span id="cb185-26"><a href="4-4-adaptive.html#cb185-26"></a>        z &lt;-<span class="st"> </span><span class="kw">log</span>(a2 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b2) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q1) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2</span>
<span id="cb185-27"><a href="4-4-adaptive.html#cb185-27"></a>        reject &lt;-<span class="st"> </span><span class="kw">u</span>(n <span class="op">-</span><span class="st"> </span>i) <span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b2)</span>
<span id="cb185-28"><a href="4-4-adaptive.html#cb185-28"></a>      }</span>
<span id="cb185-29"><a href="4-4-adaptive.html#cb185-29"></a>    }</span>
<span id="cb185-30"><a href="4-4-adaptive.html#cb185-30"></a>    y[i] &lt;-<span class="st"> </span>z</span>
<span id="cb185-31"><a href="4-4-adaptive.html#cb185-31"></a>  }</span>
<span id="cb185-32"><a href="4-4-adaptive.html#cb185-32"></a>  y</span>
<span id="cb185-33"><a href="4-4-adaptive.html#cb185-33"></a>}</span></code></pre></div>

<div class="figure" style="text-align: center"><span id="fig:Beta-sim"></span>
<img src="CSwR_files/figure-html/Beta-sim-1.png" alt="Histograms of simulated variables from Beta distributions using the rejection sampler with the adaptive envelope based on log-concavity. The true density (blue) and the envelope (red) are added to the plots." width="100%" />
<p class="caption">
Figure 4.6: Histograms of simulated variables from Beta distributions using the rejection sampler with the adaptive envelope based on log-concavity. The true density (blue) and the envelope (red) are added to the plots.
</p>
</div>
<p>Note that as a safeguard we implemented a test on the <span class="math inline">\(a_i\)</span>-s to check that
the formulas used are actually meaningful, specifically that there are no
divisions by zero.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="4-4-adaptive.html#cb186-1"></a><span class="kw">Betasim</span>(<span class="dv">1</span>, <span class="dt">x1 =</span> <span class="fl">0.25</span>, <span class="dt">x2 =</span> <span class="fl">0.75</span>, <span class="dt">alpha =</span> <span class="dv">4</span>, <span class="dt">beta =</span> <span class="dv">2</span>)  </span></code></pre></div>
<pre><code>## Error in Betasim(1, x1 = 0.25, x2 = 0.75, alpha = 4, beta = 2): ##
The implementation requires a_1 and a_2 different ## and both different
from zero. Choose different values of x_1 and x_2.```

```r
Betasim(1, x1 = 0.2, x2 = 0.75, alpha = 4, beta = 2)   </code></pre>
<pre><code>## Error in Betasim(1, x1 = 0.2, x2 = 0.75, alpha = 4, beta = 2): ##
The implementation requires a_1 and a_2 different ## and both different
from zero. Choose different values of x_1 and x_2.```

```r
Betasim(1, x1 = 0.2, x2 = 0.8, alpha = 4, beta = 2)    </code></pre>
<pre><code>## [1] 0.761879</code></pre>
</div>
<div id="von-mises-distribution" class="section level3">
<h3><span class="header-section-number">4.4.2</span> von Mises distribution</h3>
<p>The <a href="4-3-reject-samp.html#vMsim">von Mises rejection sampler</a> in Section <a href="4-3-reject-samp.html#vMsim">4.3.1</a> used the
uniform distribution as proposal distribution. As it turns out, the uniform
density is not a particularly tight envelope. We illustrate this by
studying the proportion of rejections for our previous implementation.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="4-4-adaptive.html#cb190-1"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="fl">0.1</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb190-2"><a href="4-4-adaptive.html#cb190-2"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="fl">0.5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb190-3"><a href="4-4-adaptive.html#cb190-3"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="dv">2</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb190-4"><a href="4-4-adaptive.html#cb190-4"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim</span>(<span class="dv">10000</span>, <span class="dv">5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## kappa = 0.1 : 0.09156977 
## kappa = 0.5 : 0.3561679 
## kappa = 2 : 0.6932986 
## kappa = 5 : 0.816507</code></pre>
<p>The rejection frequency is high and increases with <span class="math inline">\(\kappa\)</span>. For <span class="math inline">\(\kappa = 5\)</span>
more than 80% of the proposals are rejected, and simulating <span class="math inline">\(n = 10,000\)</span>
von Mises distributed variables thus requires the simulation of around <span class="math inline">\(50,000\)</span>
variables from the proposal.</p>
<p>The von Mises density is, unfortunately, not log-concave on <span class="math inline">\((-\pi, \pi)\)</span>,
but it is on <span class="math inline">\((-\pi/2, \pi/2)\)</span>. It is, furthermore, log-convex on <span class="math inline">\((-\pi, -\pi/2)\)</span>
as well as <span class="math inline">\((\pi/2, \pi)\)</span>, which implies that on these two intervals the
log-density is below the corresponding chords. These chords can be
pieced together with tangents to give an envelope.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="4-4-adaptive.html#cb192-1"></a>vMsim_adapt &lt;-<span class="st"> </span><span class="cf">function</span>(n, x1, x2, kappa, <span class="dt">trace =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb192-2"><a href="4-4-adaptive.html#cb192-2"></a>  lf &lt;-<span class="st"> </span><span class="cf">function</span>(x) kappa <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(x) </span>
<span id="cb192-3"><a href="4-4-adaptive.html#cb192-3"></a>  lf_deriv &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="op">-</span><span class="st"> </span>kappa <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(x)</span>
<span id="cb192-4"><a href="4-4-adaptive.html#cb192-4"></a>  a1 &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>kappa <span class="op">/</span><span class="st"> </span>pi</span>
<span id="cb192-5"><a href="4-4-adaptive.html#cb192-5"></a>  a2 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x1)</span>
<span id="cb192-6"><a href="4-4-adaptive.html#cb192-6"></a>  a3 &lt;-<span class="st"> </span><span class="kw">lf_deriv</span>(x2)</span>
<span id="cb192-7"><a href="4-4-adaptive.html#cb192-7"></a>  a4 &lt;-<span class="st"> </span><span class="op">-</span><span class="st"> </span>a1</span>
<span id="cb192-8"><a href="4-4-adaptive.html#cb192-8"></a>  </span>
<span id="cb192-9"><a href="4-4-adaptive.html#cb192-9"></a>  b1 &lt;-<span class="st"> </span>kappa</span>
<span id="cb192-10"><a href="4-4-adaptive.html#cb192-10"></a>  b2 &lt;-<span class="st"> </span><span class="kw">lf</span>(x1) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>x1</span>
<span id="cb192-11"><a href="4-4-adaptive.html#cb192-11"></a>  b3 &lt;-<span class="st"> </span><span class="kw">lf</span>(x2) <span class="op">-</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>x2</span>
<span id="cb192-12"><a href="4-4-adaptive.html#cb192-12"></a>  b4 &lt;-<span class="st"> </span>kappa</span>
<span id="cb192-13"><a href="4-4-adaptive.html#cb192-13"></a>  </span>
<span id="cb192-14"><a href="4-4-adaptive.html#cb192-14"></a>  z0 &lt;-<span class="st"> </span><span class="op">-</span>pi</span>
<span id="cb192-15"><a href="4-4-adaptive.html#cb192-15"></a>  z1 &lt;-<span class="st"> </span><span class="op">-</span>pi<span class="op">/</span><span class="dv">2</span></span>
<span id="cb192-16"><a href="4-4-adaptive.html#cb192-16"></a>  z2 &lt;-<span class="st"> </span>(b3 <span class="op">-</span><span class="st"> </span>b2) <span class="op">/</span><span class="st"> </span>(a2 <span class="op">-</span><span class="st"> </span>a3)</span>
<span id="cb192-17"><a href="4-4-adaptive.html#cb192-17"></a>  z3 &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">2</span></span>
<span id="cb192-18"><a href="4-4-adaptive.html#cb192-18"></a>  z4 &lt;-<span class="st"> </span>pi</span>
<span id="cb192-19"><a href="4-4-adaptive.html#cb192-19"></a>  </span>
<span id="cb192-20"><a href="4-4-adaptive.html#cb192-20"></a>  Q1 &lt;-<span class="st"> </span><span class="kw">exp</span>(b1) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z1) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z0)) <span class="op">/</span><span class="st"> </span>a1 </span>
<span id="cb192-21"><a href="4-4-adaptive.html#cb192-21"></a>  Q2 &lt;-<span class="st"> </span>Q1 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b2) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z2) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2</span>
<span id="cb192-22"><a href="4-4-adaptive.html#cb192-22"></a>  Q3 &lt;-<span class="st"> </span>Q2 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b3) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a3 <span class="op">*</span><span class="st"> </span>z3) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a3 <span class="op">*</span><span class="st"> </span>z2)) <span class="op">/</span><span class="st"> </span>a3</span>
<span id="cb192-23"><a href="4-4-adaptive.html#cb192-23"></a>  c &lt;-<span class="st"> </span>Q3 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(b4) <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(a4 <span class="op">*</span><span class="st"> </span>z4) <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(a4 <span class="op">*</span><span class="st"> </span>z3)) <span class="op">/</span><span class="st"> </span>a4</span>
<span id="cb192-24"><a href="4-4-adaptive.html#cb192-24"></a>  </span>
<span id="cb192-25"><a href="4-4-adaptive.html#cb192-25"></a>  count &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb192-26"><a href="4-4-adaptive.html#cb192-26"></a>  y &lt;-<span class="st"> </span><span class="kw">numeric</span>(n)</span>
<span id="cb192-27"><a href="4-4-adaptive.html#cb192-27"></a>  uy &lt;-<span class="st"> </span><span class="kw">rng_stream</span>(n, runif)</span>
<span id="cb192-28"><a href="4-4-adaptive.html#cb192-28"></a>  u &lt;-<span class="st"> </span><span class="kw">rng_stream</span>(n, runif)</span>
<span id="cb192-29"><a href="4-4-adaptive.html#cb192-29"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb192-30"><a href="4-4-adaptive.html#cb192-30"></a>    reject &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb192-31"><a href="4-4-adaptive.html#cb192-31"></a>    <span class="cf">while</span>(reject) {</span>
<span id="cb192-32"><a href="4-4-adaptive.html#cb192-32"></a>      count &lt;-<span class="st"> </span>count <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb192-33"><a href="4-4-adaptive.html#cb192-33"></a>      u0 &lt;-<span class="st"> </span>c <span class="op">*</span><span class="st"> </span><span class="kw">uy</span>(n <span class="op">-</span><span class="st"> </span>i)</span>
<span id="cb192-34"><a href="4-4-adaptive.html#cb192-34"></a>      <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q1) {</span>
<span id="cb192-35"><a href="4-4-adaptive.html#cb192-35"></a>        z &lt;-<span class="st"> </span><span class="kw">log</span>(a1 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b1) <span class="op">*</span><span class="st"> </span>u0 <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a1 <span class="op">*</span><span class="st"> </span>z0)) <span class="op">/</span><span class="st"> </span>a1</span>
<span id="cb192-36"><a href="4-4-adaptive.html#cb192-36"></a>        reject &lt;-<span class="st"> </span><span class="kw">u</span>(n <span class="op">-</span><span class="st"> </span>i) <span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a1 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b1)</span>
<span id="cb192-37"><a href="4-4-adaptive.html#cb192-37"></a>      } <span class="cf">else</span> <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q2) {</span>
<span id="cb192-38"><a href="4-4-adaptive.html#cb192-38"></a>        z &lt;-<span class="st"> </span><span class="kw">log</span>(a2 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b2) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q1) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a2 <span class="op">*</span><span class="st"> </span>z1)) <span class="op">/</span><span class="st"> </span>a2</span>
<span id="cb192-39"><a href="4-4-adaptive.html#cb192-39"></a>        reject &lt;-<span class="st"> </span><span class="kw">u</span>(n <span class="op">-</span><span class="st"> </span>i) <span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a2 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b2)</span>
<span id="cb192-40"><a href="4-4-adaptive.html#cb192-40"></a>      } <span class="cf">else</span> <span class="cf">if</span>(u0 <span class="op">&lt;</span><span class="st"> </span>Q3) {</span>
<span id="cb192-41"><a href="4-4-adaptive.html#cb192-41"></a>        z &lt;-<span class="st"> </span><span class="kw">log</span>(a3 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b3) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q2) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a3 <span class="op">*</span><span class="st"> </span>z2)) <span class="op">/</span><span class="st"> </span>a3</span>
<span id="cb192-42"><a href="4-4-adaptive.html#cb192-42"></a>        reject &lt;-<span class="st"> </span><span class="kw">u</span>(n <span class="op">-</span><span class="st"> </span>i) <span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a3 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b3)</span>
<span id="cb192-43"><a href="4-4-adaptive.html#cb192-43"></a>      } <span class="cf">else</span> {</span>
<span id="cb192-44"><a href="4-4-adaptive.html#cb192-44"></a>        z &lt;-<span class="st"> </span><span class="kw">log</span>(a4 <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b4) <span class="op">*</span><span class="st"> </span>(u0 <span class="op">-</span><span class="st"> </span>Q3) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(a4 <span class="op">*</span><span class="st"> </span>z3)) <span class="op">/</span><span class="st"> </span>a4</span>
<span id="cb192-45"><a href="4-4-adaptive.html#cb192-45"></a>        reject &lt;-<span class="st"> </span><span class="kw">u</span>(n <span class="op">-</span><span class="st"> </span>i) <span class="op">&gt;</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">lf</span>(z) <span class="op">-</span><span class="st"> </span>a4 <span class="op">*</span><span class="st"> </span>z <span class="op">-</span><span class="st"> </span>b4)</span>
<span id="cb192-46"><a href="4-4-adaptive.html#cb192-46"></a>      }</span>
<span id="cb192-47"><a href="4-4-adaptive.html#cb192-47"></a>    }</span>
<span id="cb192-48"><a href="4-4-adaptive.html#cb192-48"></a>    y[i] &lt;-<span class="st"> </span>z</span>
<span id="cb192-49"><a href="4-4-adaptive.html#cb192-49"></a>  }</span>
<span id="cb192-50"><a href="4-4-adaptive.html#cb192-50"></a>  <span class="cf">if</span>(trace)</span>
<span id="cb192-51"><a href="4-4-adaptive.html#cb192-51"></a>    <span class="kw">cat</span>(<span class="st">&quot;kappa =&quot;</span>, kappa, <span class="st">&quot;, x1 =&quot;</span>, x1, </span>
<span id="cb192-52"><a href="4-4-adaptive.html#cb192-52"></a>        <span class="st">&quot;, x2 =&quot;</span>, x2, <span class="st">&quot;:&quot;</span>, (count <span class="op">-</span><span class="st"> </span>n) <span class="op">/</span><span class="st"> </span>count, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)  </span>
<span id="cb192-53"><a href="4-4-adaptive.html#cb192-53"></a>  y</span>
<span id="cb192-54"><a href="4-4-adaptive.html#cb192-54"></a>}</span></code></pre></div>

<div class="figure" style="text-align: center"><span id="fig:vM-adaptive-test"></span>
<img src="CSwR_files/figure-html/vM-adaptive-test-1.png" alt="Histograms of simulated variables from von Mises distributions using the rejection sampler with the adaptive envelope based on a combination of log-concavity and log-convexity. The true density (blue) and the envelope (red) are added to the plots." width="100%" />
<p class="caption">
Figure 4.7: Histograms of simulated variables from von Mises distributions using the rejection sampler with the adaptive envelope based on a combination of log-concavity and log-convexity. The true density (blue) and the envelope (red) are added to the plots.
</p>
</div>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="4-4-adaptive.html#cb193-1"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="fl">-0.4</span>, <span class="fl">0.4</span>, <span class="dv">5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb193-2"><a href="4-4-adaptive.html#cb193-2"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="dv">-1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb193-3"><a href="4-4-adaptive.html#cb193-3"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="fl">-0.1</span>, <span class="fl">0.1</span>, <span class="dv">5</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb193-4"><a href="4-4-adaptive.html#cb193-4"></a>y &lt;-<span class="st"> </span><span class="kw">vMsim_adapt</span>(<span class="dv">100000</span>, <span class="fl">-0.4</span>, <span class="fl">0.4</span>, <span class="dv">2</span>, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## kappa = 5 , x1 = -0.4 , x2 = 0.4 : 0.1996414 
## kappa = 2 , x1 = -1 , x2 = 1 : 0.2412459 
## kappa = 5 , x1 = -0.1 , x2 = 0.1 : 0.4844059 
## kappa = 2 , x1 = -0.4 , x2 = 0.4 : 0.1557619</code></pre>
<p>We see that compared to using the uniform density as envelope, these adaptive
envelopes are generally tighter and leads to fewer rejections. Even tighter
envelopes are possible by using more than four intervals, but it is, of course,
always a good question how the added complexity and bookkeeping induced by
using more advanced and adaptive envelopes affect run time. It is even a good question
if our current adaptive implementation will outperform our first, and
much simpler, implementation that used the uniform envelope.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="4-4-adaptive.html#cb195-1"></a><span class="kw">microbenchmark</span>(<span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="dv">-1</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb195-2"><a href="4-4-adaptive.html#cb195-2"></a>               <span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="fl">-0.4</span>, <span class="fl">0.4</span>, <span class="dv">5</span>),</span>
<span id="cb195-3"><a href="4-4-adaptive.html#cb195-3"></a>               <span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="fl">-0.2</span>, <span class="fl">0.2</span>, <span class="dv">5</span>),</span>
<span id="cb195-4"><a href="4-4-adaptive.html#cb195-4"></a>               <span class="kw">vMsim_adapt</span>(<span class="dv">100</span>, <span class="fl">-0.1</span>, <span class="fl">0.1</span>, <span class="dv">5</span>),</span>
<span id="cb195-5"><a href="4-4-adaptive.html#cb195-5"></a>               <span class="kw">vMsim</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb195-6"><a href="4-4-adaptive.html#cb195-6"></a>               <span class="kw">vMsim_vec</span>(<span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb195-7"><a href="4-4-adaptive.html#cb195-7"></a>               )</span></code></pre></div>
<pre><code>## Unit: microseconds
##                            expr min  lq mean median  uq  max neval
##      vMsim_adapt(100, -1, 1, 5) 568 652  709    699 754  939   100
##  vMsim_adapt(100, -0.4, 0.4, 5) 285 322  354    346 369  520   100
##  vMsim_adapt(100, -0.2, 0.2, 5) 345 378  413    396 430  705   100
##  vMsim_adapt(100, -0.1, 0.1, 5) 411 474  527    500 549 1297   100
##                   vMsim(100, 5) 596 686  772    742 823 1559   100
##               vMsim_vec(100, 5)  61  76   91     83  96  243   100</code></pre>
<p>The results from the benchmark show that the adaptive implementation has
run time comparable to using the uniform proposal.
With <span class="math inline">\(x_1 = -0.4\)</span> and <span class="math inline">\(x_2 = 0.4\)</span> and <span class="math inline">\(\kappa = 5\)</span>
we found above that the rejection frequency was about 20% with
the adaptive envelope, while it was about 80% when using the uniform
envelope. A naive computation would thus suggest a speedup of a
factor 4, but using the adaptive envelope there is actually only
a speedup of a factor 2. And the vectorized solution is still
considerably faster. A completely vectorized solution using
the adaptive envelope is possible, but it is not entirely
straightforward how to implement the more complicated envelope
efficiently, and it may be a better option in this case to implement
it using Rcpp.</p>
<p>Even if either implementation can be improved further in terms of run time,
it is an important point when comparing algorithms that we don’t get too
focused on surrogate performance quantities. The probability of rejection
is a surrogate for actual run time, and it might be conceptually of interest
to bring this probability down. But if it is at the expense of additional
computations it might not be worth the effort in terms of real run time.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-3-reject-samp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="4-5-univariate-ex.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
